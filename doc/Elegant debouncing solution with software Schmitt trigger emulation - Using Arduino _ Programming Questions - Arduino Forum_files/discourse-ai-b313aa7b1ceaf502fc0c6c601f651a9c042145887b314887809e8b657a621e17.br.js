define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-plugin-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins.show",path:"/plugins",map(){this.route("discourse-ai-personas",{path:"ai-personas"},(function(){this.route("new"),this.route("show",{path:"/:id"})})),this.route("discourse-ai-llms",{path:"ai-llms"},(function(){this.route("new"),this.route("show",{path:"/:id"})})),this.route("discourse-ai-tools",{path:"ai-tools"},(function(){this.route("new"),this.route("show",{path:"/:id"})})),this.route("discourse-ai-usage",{path:"ai-usage"})}}})),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-llm",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-llm"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-persona"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-tool",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-tool"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-llm",["exports","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","name","provider","tokenizer","max_prompt_tokens","url","api_key","enabled_chat_bot","provider_params","vision_enabled")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}async testConfig(){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-llms/test.json",{data:{ai_llm:this.createProperties()}})}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=["id","name","description","tools","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","default_llm","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","question_consolidator_llm","allow_chat","tool_details","forced_tool_count","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages"],n=["id","allowed_group_ids","enabled","system","priority","user_id","default_llm","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","question_consolidator_llm","tool_details","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages"]
class a{static#e=(()=>dt7948.g(this.prototype,"value",[t.tracked],(function(){return null})))()
#t=(()=>{dt7948.i(this,"value")})()}class r extends i.default{init(e){this.forcedTools=[],e.tools&&(e.tools=e.tools.map((e=>{if("string"==typeof e)return e
{let[t,s,i]=e
for(let e in s)s.hasOwnProperty(e)&&(this.getToolOption(t,e).value=s[e])
return i&&this.forcedTools.push(t),t}}))),super.init(e),this.tools=e.tools}async createUser(){const e=await(0,s.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}getToolOption(e,t){return this.toolOptions||={},this.toolOptions[e]||={},this.toolOptions[e][t]||=new a}populateToolOptions(e){if(!e.tools)return
let t=[]
e.tools.forEach((e=>{"string"!=typeof e&&(e=e[0])
let s=this.forcedTools.includes(e)
if(this.toolOptions&&this.toolOptions[e]){let i=this.toolOptions[e],o={}
for(let e in i){if(!i.hasOwnProperty(e))continue
let t=i[e]
o[e]=t.value}t.push([e,o,s])}else t.push([e,{},s])})),e.tools=t}updateProperties(){let e=this.system?this.getProperties(n):this.getProperties(o)
return e.id=this.id,this.populateToolOptions(e),e}createProperties(){let e=this.getProperties(o)
return this.populateToolOptions(e),e}workingCopy(){let e=this.getProperties(o)
this.populateToolOptions(e)
const t=r.create(e)
return t.forcedTools=(this.forcedTools||[]).slice(),t.forced_tool_count=this.forced_tool_count||-1,t}}e.default=r})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-tool",["exports","@ember-compat/tracked-built-ins","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","description","parameters","script","summary","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","enabled"]
class o extends s.default{createProperties(){return this.getProperties(i)}updateProperties(){return this.getProperties(i)}trackParameters(e){return new t.TrackedArray(e?.map((e=>{const s=new t.TrackedObject(e)
return s.enum&&s.enum.length?s.enum=new t.TrackedArray(s.enum):s.enum=null,s})))}workingCopy(){const e=this.getProperties(i)
return e.parameters=this.trackParameters(e.parameters),this.store.createRecord("ai-tool",e)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/components/admin-report-emotion",["exports","@ember/component","@ember-decorators/component","discourse-common/lib/get-url","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,o.createTemplateFactory)({id:"3bzlcdRS",block:'[[[10,0],[14,0,"cell title"],[12],[1,"\\n"],[41,[30,0,["model","icon"]],[[[1,"    "],[1,[28,[35,1],[[30,0,["model","icon"]]],null]],[1,"\\n"]],[]],null],[1,"  "],[1,[30,0,["model","title"]]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"cell value today-count"],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["todayLink"]]],[12],[1,"\\n    "],[1,[28,[35,2],[[30,0,["model","todayCount"]]],null]],[1,"\\n  "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value yesterday-count ",[30,0,["model","yesterdayTrend"]]]]],[15,"title",[30,0,["model","yesterdayCountTitle"]]],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["yesterdayLink"]]],[12],[1,"\\n    "],[1,[28,[35,2],[[30,0,["model","yesterdayCount"]]],null]],[1,"\\n  "],[13],[1,"\\n  "],[1,[28,[35,1],[[30,0,["model","yesterdayTrendIcon"]]],null]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value sevendays-count ",[30,0,["model","sevenDaysTrend"]]]]],[15,"title",[30,0,["model","sevenDaysCountTitle"]]],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["lastSevenDaysLink"]]],[12],[1,"\\n    "],[1,[28,[35,2],[[30,0,["model","lastSevenDaysCount"]]],null]],[1,"\\n  "],[13],[1,"\\n  "],[1,[28,[35,1],[[30,0,["model","sevenDaysTrendIcon"]]],null]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value thirty-days-count ",[30,0,["model","thirtyDaysTrend"]]]]],[15,"title",[30,0,["model","thirtyDaysCountTitle"]]],[12],[1,"\\n\\n  "],[10,3],[15,6,[30,0,["lastThirtyDaysLink"]]],[12],[1,"\\n    "],[1,[28,[35,2],[[30,0,["model","lastThirtyDaysCount"]]],null]],[1,"\\n  "],[13],[1,"\\n"],[41,[30,0,["model","canDisplayTrendIcon"]],[[[1,"    "],[1,[28,[35,1],[[30,0,["model","thirtyDaysTrendIcon"]]],null]],[1,"\\n"]],[]],null],[13]],[],false,["if","d-icon","number"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/admin-report-emotion.hbs",isStrictMode:!1}),a=dt7948.c(class extends t.default{get todayLink(){let e=moment().format("YYYY-MM-DD")
return this._filterURL(e)}get yesterdayLink(){let e=moment().subtract(1,"day").format("YYYY-MM-DD")
return this._filterURL(e)}get lastSevenDaysLink(){let e=moment().subtract(1,"week").format("YYYY-MM-DD")
return this._filterURL(e)}get lastThirtyDaysLink(){let e=moment().subtract(1,"month").format("YYYY-MM-DD")
return this._filterURL(e)}_baseFilter(){return"/filter?q=activity-after%3A"}_model(){return"%20order%3A"+this.model.type}_filterURL(e){return(0,i.default)(`${this._baseFilter()}${e}${this._model()}`)}},[(0,s.attributeBindings)("model.description:title"),(0,s.classNames)("admin-report-counters")])
e.default=(0,t.setComponentTemplate)(n,a)})),define("discourse/plugins/discourse-ai/discourse/components/ai-artifact",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/html-class","discourse-common/lib/get-url","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"expanded",[s.tracked],(function(){return!1})))()
#o=(()=>{dt7948.i(this,"expanded")})()
static#n=(()=>dt7948.g(this.prototype,"showingArtifact",[s.tracked],(function(){return!1})))()
#a=(()=>{dt7948.i(this,"showingArtifact")})()
constructor(){super(...arguments),this.keydownHandler=this.handleKeydown.bind(this)}willDestroy(){super.willDestroy(...arguments),window.removeEventListener("keydown",this.keydownHandler)}handleKeydown(e){"Escape"!==e.key&&"Esc"!==e.key||(this.expanded=!1)}static#r=(()=>dt7948.n(this.prototype,"handleKeydown",[o.action]))()
get requireClickToRun(){return!this.showingArtifact&&"strict"===this.siteSettings.ai_artifact_security}get artifactUrl(){let e=(0,l.default)(`/discourse-ai/ai-bot/artifacts/${this.args.artifactId}`)
return this.args.artifactVersion&&(e=`${e}/${this.args.artifactVersion}`),e}showArtifact(){this.showingArtifact=!0}static#l=(()=>dt7948.n(this.prototype,"showArtifact",[o.action]))()
toggleView(){this.expanded=!this.expanded,this.expanded?window.addEventListener("keydown",this.keydownHandler):window.removeEventListener("keydown",this.keydownHandler)}static#c=(()=>dt7948.n(this.prototype,"toggleView",[o.action]))()
get wrapperClasses(){return"ai-artifact__wrapper "+(this.expanded?"ai-artifact__expanded":"")}artifactPanelHover(){const e=document.querySelector(".ai-artifact__panel")
e.style.animation="none",setTimeout((()=>{e.style.animation=""}),0)}static#u=(()=>dt7948.n(this.prototype,"artifactPanelHover",[o.action]))()
static#d=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"f93nmn4N",block:'[[[1,"\\n"],[41,[30,0,["expanded"]],[[[1,"      "],[1,[28,[32,0],["ai-artifact-expanded"],null]],[1,"\\n"]],[]],null],[1,"    "],[10,0],[15,0,[30,0,["wrapperClasses"]]],[12],[1,"\\n      "],[11,0],[24,0,"ai-artifact__panel--wrapper"],[4,[32,1],["mouseleave",[30,0,["artifactPanelHover"]]],null],[12],[1,"\\n        "],[10,0],[14,0,"ai-artifact__panel"],[12],[1,"\\n          "],[8,[32,2],[[24,0,"btn-flat btn-icon-text"]],[["@icon","@label","@action"],["discourse-compress","discourse_ai.ai_artifact.collapse_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["requireClickToRun"]],[[[1,"        "],[10,0],[14,0,"ai-artifact__click-to-run"],[12],[1,"\\n          "],[8,[32,2],[[24,0,"btn btn-primary"]],[["@icon","@label","@action"],["play","discourse_ai.ai_artifact.click_to_run_label",[30,0,["showArtifact"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[10,"iframe"],[14,"title","AI Artifact"],[15,"src",[30,0,["artifactUrl"]]],[14,"width","100%"],[14,"frameborder","0"],[12],[13],[1,"\\n"]],[]]],[41,[51,[30,0,["requireClickToRun"]]],[[[1,"        "],[10,0],[14,0,"ai-artifact__footer"],[12],[1,"\\n          "],[8,[32,2],[[24,0,"btn-flat btn-icon-text ai-artifact__expand-button"]],[["@icon","@label","@action"],["discourse-expand","discourse_ai.ai_artifact.expand_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-artifact.js",scope:()=>[r.default,i.on,a.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"composer",[i.service]))()
#m=(()=>{dt7948.i(this,"composer")})()
get bots(){const e=this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persosna)).filter(Boolean)
return e?e.map((e=>e.model_name)):[]}get showHeaderButton(){return this.bots.length>0&&this.siteSettings.ai_bot_add_to_header}compose(){(0,a.composeAiBotMessage)(this.bots[0],this.composer)}static#r=(()=>dt7948.n(this.prototype,"compose",[s.action]))()
static#l=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"NL7Zjh9n",block:'[[[1,"\\n"],[41,[30,0,["showHeaderButton"]],[[[1,"      "],[10,"li"],[12],[1,"\\n        "],[8,[32,0],[[16,"title",[28,[32,1],["discourse_ai.ai_bot.shortcut_title"],null]],[24,0,"ai-bot-button icon btn-flat"]],[["@action","@icon"],[[30,0,["compose"]],"robot"]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon.js",scope:()=>[o.default,n.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/owner","@ember/service","discourse-i18n","float-kit/components/d-toast","float-kit/lib/d-toast-instance","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[n.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"currentUser",[n.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#r=(()=>dt7948.g(this.prototype,"site",[n.service]))()
#h=(()=>{dt7948.i(this,"site")})()
static#l=(()=>dt7948.g(this.prototype,"newSelectedText",[s.tracked]))()
#_=(()=>{dt7948.i(this,"newSelectedText")})()
static#c=(()=>dt7948.g(this.prototype,"diff",[s.tracked]))()
#f=(()=>{dt7948.i(this,"diff")})()
static#u=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#b=(()=>{dt7948.i(this,"customPromptValue")})()
static#d=(()=>dt7948.g(this.prototype,"noContentError",[s.tracked],(function(){return!1})))()
#y=(()=>{dt7948.i(this,"noContentError")})()
prompts=[]
promptTypes={}
constructor(){super(...arguments),0===this.args.data.toolbarEvent.getText().length&&(this.noContentError=!0)}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("composer"))).filter((e=>"generate_titles"!==e.name)).map((e=>{const t=this.siteSettings.default_locale,s=JSON.parse(this.siteSettings.available_locales).find((e=>e.value===t)),i=a.default.t("discourse_ai.ai_helper.context_menu.translate_prompt",{language:s.name})
return"translate"===e.name?{...e,translated_name:i}:e}))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this.currentUser?.can_use_custom_prompts||(e=e.filter((e=>"custom_prompt"!==e.name))),e.forEach((e=>{this.prompts[e.id]=e})),this.promptTypes=e.reduce(((e,t)=>(e[t.name]=t.prompt_type,e)),{}),e}get toast(){const e=(0,o.getOwner)(this),t={close:()=>this.args.close(),duration:3e3,data:{theme:"error",icon:"triangle-exclamation",message:a.default.t("discourse_ai.ai_helper.no_content_error")}}
return new class extends l.default{constructor(){super(e,t)}close(){this.options.close()}static#e=(()=>dt7948.n(this.prototype,"close",[i.action]))()}(e,t)}async suggestChanges(e){return await this.args.close(),"illustrate_post"===e.name?this.modal.show(d.default,{model:{mode:e.id,selectedText:this.args.data.selectedText,thumbnails:this.thumbnailSuggestions}}):this.modal.show(u.default,{model:{mode:e.id,selectedText:this.args.data.selectedText,revert:this.undoAiAction,toolbarEvent:this.args.data.toolbarEvent,customPromptValue:this.customPromptValue}})}static#v=(()=>dt7948.n(this.prototype,"suggestChanges",[i.action]))()
closeMenu(){this.customPromptValue="",this.args.close()}static#w=(()=>dt7948.n(this.prototype,"closeMenu",[i.action]))()
static#x=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"2ahoy4kS",block:'[[[1,"\\n"],[41,[30,0,["noContentError"]],[[[1,"      "],[8,[32,0],null,[["@toast"],[[30,0,["toast"]]]],null],[1,"\\n"]],[]],[[[1,"      "],[10,0],[14,0,"ai-composer-helper-menu"],[12],[1,"\\n"],[41,[30,0,["site","mobileView"]],[[[1,"          "],[10,0],[14,0,"ai-composer-helper-menu__selected-text"],[12],[1,"\\n            "],[1,[30,1,["selectedText"]]],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[32,1],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["suggestChanges"]],true]],null],[1,"\\n      "],[13],[1,"\\n"]],[]]],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu.js",scope:()=>[r.default,c.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-forced-tool-strategy-selector",["exports","@ember/object","discourse-i18n","select-kit/components/combo-box"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=i.default.extend({content:(0,t.computed)((function(){const e=[{id:-1,name:s.default.t("discourse_ai.ai_persona.tool_strategies.all")}]
return[1,2,5].forEach((t=>{e.push({id:t,name:s.default.t("discourse_ai.ai_persona.tool_strategies.replies",{count:t})})})),e})),selectKitOptions:{filterable:!1}})})),define("discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/body-class","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"gists",[o.service]))()
#k=(()=>{dt7948.i(this,"gists")})()
get buttons(){return[{id:"table",label:"discourse_ai.summarization.topic_list_layout.button.compact",icon:"discourse-table"},{id:"table-ai",label:"discourse_ai.summarization.topic_list_layout.button.expanded",icon:"discourse-table-sparkles",description:"discourse_ai.summarization.topic_list_layout.button.expanded_description"}]}get selectedOptionId(){return this.gists.get("preference")}get currentButton(){return this.buttons.find((e=>e.id===this.selectedOptionId))||this.buttons[0]}onRegisterApi(e){this.dMenu=e}static#i=(()=>dt7948.n(this.prototype,"onRegisterApi",[i.action]))()
onSelect(e){this.gists.setPreference(e),this.dMenu.close()}static#n=(()=>dt7948.n(this.prototype,"onSelect",[i.action]))()
static#r=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"WNCmZBDe",block:'[[[1,"\\n"],[41,[30,0,["gists","shouldShow"]],[[[1,"      "],[1,[28,[32,0],[[28,[32,1],["topic-list-layout-",[30,0,["gists","preference"]]],null]],null]],[1,"\\n      "],[8,[32,2],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"topic-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,3],[[30,0,["currentButton","icon"]]],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["buttons"]]],null]],null],null,[[[1,"              "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,5],[[16,0,[29,["btn-transparent\\n                    ",[52,[30,2,["description"]],"--with-description"],"\\n                    ",[52,[28,[32,6],[[30,0,["currentButton","id"]],[30,2,["id"]]],null],"--active"]]]]],[["@label","@icon","@action"],[[30,2,["label"]],[30,2,["icon"]],[28,[32,7],[[30,0,["onSelect"]],[30,2,["id"]]],null]]],[["default"],[[[[1,"\\n"],[41,[30,2,["description"]],[[[1,"                    "],[10,0],[14,0,"btn__description"],[12],[1,"\\n                      "],[1,[28,[32,8],[[30,2,["description"]]],null]],[1,"\\n                    "],[13],[1,"\\n"]],[]],null],[1,"                "]],[]]]]],[1,"\\n              "]],[]]]]],[1,"\\n"]],[2]],null],[1,"          "]],[1]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","button"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle.js",scope:()=>[r.default,s.concat,u.default,l.default,a.default,n.default,d.default,s.fn,c.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/helpers/with-event-value","discourse-common/helpers/i18n","truth-helpers/helpers/not","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{sendInput(e){if("Enter"===e.key)return this.args.submit(this.args.promptArgs)}static#e=(()=>dt7948.n(this.prototype,"sendInput",[o.action]))()
static#i=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"P6muo3ex",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-custom-prompt"],[12],[1,"\\n\\n      "],[11,"input"],[16,2,[30,1]],[16,"placeholder",[28,[32,0],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"],[24,"autofocus","autofocus"],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,0],[[30,1]],null]],null]],null]],null],[4,[32,1],["keydown",[30,0,["sendInput"]]],null],[12],[13],[1,"\\n\\n      "],[8,[32,4],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,3],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@value","@submit","@promptArgs"],false,["mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[r.default,i.on,a.default,s.fn,n.default,l.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-common/helpers/i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"qC8lok7p",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-helper-loading"],[12],[1,"\\n    "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n    "],[10,1],[12],[1,"\\n      "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["xmark","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"]],["@cancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[s.default,t.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-helper-loading:AiHelperLoading"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list",["exports","@glimmer/component","@ember/helper","@ember/service","truth-helpers","discourse/components/d-button","discourse/lib/keyboard-shortcuts","discourse/lib/utilities","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[i.service]))()
#h=(()=>{dt7948.i(this,"site")})()
get showShortcut(){return this.site.desktopView&&this.args.shortcutVisible}get shortcut(){return(0,r.translateModKey)(`${a.PLATFORM_KEY_MODIFIER}+alt+p`)}static#i=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"6HgxS5V6",block:'[[[1,"\\n    "],[10,"ul"],[14,0,"ai-helper-options"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[41,[28,[32,0],[[30,2,["name"]],"custom_prompt"],null],[[[1,"          "],[8,[32,1],null,[["@value","@promptArgs","@submit"],[[30,3],[30,2],[30,4]]],null],[1,"\\n"]],[]],[[[1,"          "],[10,"li"],[15,"data-name",[30,2,["translated_name"]]],[15,"data-value",[30,2,["id"]]],[12],[1,"\\n            "],[8,[32,2],[[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,2,["id"]]],[24,0,"ai-helper-options__button"]],[["@icon","@translatedLabel","@action"],[[30,2,["icon"]],[30,2,["translated_name"]],[28,[32,3],[[30,4],[30,2]],null]]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[28,[32,0],[[30,2,["name"]],"proofread"],null],[30,0,["showShortcut"]]],null],[[[1,"                "],[10,"kbd"],[14,0,"shortcut"],[12],[1,[30,0,["shortcut"]]],[13],[1,"\\n"]],[]],null],[1,"            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]]]],[2]],null],[1,"    "],[13],[1,"\\n  "]],["@options","option","@customPromptValue","@performAction"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list.js",scope:()=>[l.default,c.default,n.default,s.fn,o.and],isStrictMode:!0}),this))()}e.default=p})),define("discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave",["exports","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=[".",".","."],n=(0,t.setComponentTemplate)((0,s.createTemplateFactory)({id:"2VboNjAG",block:'[[[1,"\\n"],[41,[30,1],[[[1,"    "],[10,1],[14,0,"ai-indicator-wave"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,0]],null]],null],null,[[[1,"        "],[10,1],[14,0,"ai-indicator-wave__dot"],[12],[1,[30,2]],[13],[1,"\\n"]],[2]],null],[1,"    "],[13],[1,"\\n"]],[]],null]],["@loading","dot"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave.js",scope:()=>[o],isStrictMode:!0}),(0,i.default)(void 0,"ai-indicator-wave:AiIndicatorWave"))
e.default=n})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/runloop","@ember/service","truth-helpers","discourse/components/d-button","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse-i18n","admin/models/admin-user","select-kit/components/combo-box","float-kit/components/d-tooltip","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f,b,y,v){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class w extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[c.service]))()
#S=(()=>{dt7948.i(this,"toasts")})()
static#i=(()=>dt7948.g(this.prototype,"router",[c.service]))()
#T=(()=>{dt7948.i(this,"router")})()
static#n=(()=>dt7948.g(this.prototype,"dialog",[c.service]))()
#M=(()=>{dt7948.i(this,"dialog")})()
static#r=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#j=(()=>{dt7948.i(this,"isSaving")})()
static#l=(()=>dt7948.g(this.prototype,"testRunning",[s.tracked],(function(){return!1})))()
#P=(()=>{dt7948.i(this,"testRunning")})()
static#c=(()=>dt7948.g(this.prototype,"testResult",[s.tracked],(function(){return null})))()
#C=(()=>{dt7948.i(this,"testResult")})()
static#u=(()=>dt7948.g(this.prototype,"testError",[s.tracked],(function(){return null})))()
#A=(()=>{dt7948.i(this,"testError")})()
static#d=(()=>dt7948.g(this.prototype,"apiKeySecret",[s.tracked],(function(){return!0})))()
#O=(()=>{dt7948.i(this,"apiKeySecret")})()
get selectedProviders(){return this.args.llms.resultSetMeta.providers.map((e=>{return{id:e,name:(t=e,_.default.t(`discourse_ai.llms.providers.${t}`))}
var t}))}get adminUser(){return f.default.create(this.args.model?.user)}get testErrorMessage(){return _.default.t("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get canEditURL(){return"aws_bedrock"!==this.args.model.provider}static#v=(()=>dt7948.n(this.prototype,"canEditURL",[(0,a.computed)("args.model.provider")]))()
get modulesUsingModel(){const e=this.args.model.used_by?.filter((e=>"ai_bot"!==e.type))
if(!e||0===e.length)return null
return e.map((e=>_.default.t(`discourse_ai.llms.usage.${e.type}`,{persona:e.name}))).join(", ")}get seeded(){return this.args.model.id<0}get inUseWarning(){return _.default.t("discourse_ai.llms.in_use_warning",{settings:this.modulesUsingModel,count:this.args.model.used_by.length})}get metaProviderParams(){return this.args.llms.resultSetMeta.provider_params[this.args.model.provider]||{}}static#w=(()=>dt7948.n(this.prototype,"metaProviderParams",[(0,a.computed)("args.model.provider")]))()
async save(){this.isSaving=!0
const e=this.args.model.isNew
try{await this.args.model.save(),e?(this.args.llms.addObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")):this.toasts.success({data:{message:_.default.t("discourse_ai.llms.saved")},duration:2e3})}catch(t){(0,m.popupAjaxError)(t)}finally{(0,l.later)((()=>{this.isSaving=!1}),1e3)}}static#x=(()=>dt7948.n(this.prototype,"save",[a.action]))()
async test(){this.testRunning=!0
try{const e=await this.args.model.testConfig()
this.testResult=e.success,this.testResult?this.testError=null:this.testError=e.error}catch(e){(0,m.popupAjaxError)(e)}finally{(0,l.later)((()=>{this.testRunning=!1}),1e3)}}static#R=(()=>dt7948.n(this.prototype,"test",[a.action]))()
makeApiKeySecret(){this.apiKeySecret=!0}static#E=(()=>dt7948.n(this.prototype,"makeApiKeySecret",[a.action]))()
toggleApiKeySecret(){this.apiKeySecret=!this.apiKeySecret}static#N=(()=>dt7948.n(this.prototype,"toggleApiKeySecret",[a.action]))()
delete(){return this.dialog.confirm({message:_.default.t("discourse_ai.llms.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.llms.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")})).catch(m.popupAjaxError)})}static#U=(()=>dt7948.n(this.prototype,"delete",[a.action]))()
static#L=(()=>(0,i.setComponentTemplate)((0,v.createTemplateFactory)({id:"TfcUbXt+",block:'[[[1,"\\n"],[41,[30,0,["seeded"]],[[[1,"      "],[10,0],[14,0,"alert alert-info"],[12],[1,"\\n        "],[1,[28,[32,0],["circle-exclamation"],null]],[1,"\\n        "],[1,[28,[32,1],["discourse_ai.llms.seeded_warning"],null]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[41,[30,0,["modulesUsingModel"]],[[[1,"      "],[10,0],[14,0,"alert alert-info"],[12],[1,"\\n        "],[1,[28,[32,0],["circle-exclamation"],null]],[1,"\\n        "],[1,[30,0,["inUseWarning"]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"    "],[10,"form"],[15,0,[29,["form-horizontal ai-llm-editor ",[52,[30,0,["seeded"]],"seeded"]]]],[12],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,0,"ai-llm-editor-input ai-llm-editor__display-name"],[16,"disabled",[30,0,["seeded"]]]],[["@type","@value"],["text",[30,1,["display_name"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.name"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,0,"ai-llm-editor-input ai-llm-editor__name"],[16,"disabled",[30,0,["seeded"]]]],[["@type","@value"],["text",[30,1,["name"]]]],null],[1,"\\n        "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1],["discourse_ai.llms.hints.name"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n        "],[8,[32,4],null,[["@value","@content","@class","@options"],[[30,1,["provider"]],[30,0,["selectedProviders"]],"ai-llm-editor__provider",[28,[32,5],null,[["disabled"],[[30,0,["seeded"]]]]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[51,[30,0,["seeded"]]],[[[41,[30,0,["canEditURL"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.url"],null]],[13],[1,"\\n            "],[8,[32,2],[[24,0,"ai-llm-editor-input ai-llm-editor__url"],[24,"required","true"]],[["@type","@value"],["text",[30,1,["url"]]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.api_key"],null]],[13],[1,"\\n          "],[10,0],[14,0,"ai-llm-editor__secret-api-key-group"],[12],[1,"\\n            "],[8,[32,2],[[24,0,"ai-llm-editor-input ai-llm-editor__api-key"],[24,"required","true"],[4,[32,6],["focusout",[30,0,["makeApiKeySecret"]]],null]],[["@value","@type"],[[30,1,["api_key"]],[52,[30,0,["apiKeySecret"]],"password","text"]]],null],[1,"\\n            "],[8,[32,7],null,[["@action","@icon"],[[30,0,["toggleApiKeySecret"]],"far-eye-slash"]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"],[42,[28,[31,3],[[30,0,["metaProviderParams"]]],null],null,[[[1,"          "],[10,0],[15,0,[29,["control-group ai-llm-editor-provider-param__",[30,2]]]],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,1],[[28,[32,8],["discourse_ai.llms.provider_fields.",[30,3]],null]],null]],[13],[1,"\\n"],[41,[28,[32,9],[[30,2],"checkbox"],null],[[[1,"              "],[8,[32,2],null,[["@type","@checked"],[[30,2],[28,[31,4],[[28,[32,10],[[30,1,["provider_params"]],[30,3]],null]],null]]],null],[1,"\\n"]],[]],[[[1,"              "],[8,[32,2],null,[["@type","@value"],[[30,2],[28,[31,4],[[28,[32,10],[[30,1,["provider_params"]],[30,3]],null]],null]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n"]],[2,3]],null],[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.tokenizer"],null]],[13],[1,"\\n          "],[8,[32,4],null,[["@value","@content","@class"],[[30,1,["tokenizer"]],[30,4,["resultSetMeta","tokenizers"]],"ai-llm-editor__tokenizer"]],null],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.max_prompt_tokens"],null]],[13],[1,"\\n          "],[8,[32,2],[[24,0,"ai-llm-editor-input ai-llm-editor__max-prompt-tokens"],[24,"step","any"],[24,"min","0"],[24,"lang","en"],[24,"required","true"]],[["@type","@value"],["number",[30,1,["max_prompt_tokens"]]]],null],[1,"\\n          "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1],["discourse_ai.llms.hints.max_prompt_tokens"],null]]],null],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"control-group ai-llm-editor__vision-enabled"],[12],[1,"\\n          "],[8,[32,2],null,[["@type","@checked"],["checkbox",[30,1,["vision_enabled"]]]],null],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.vision_enabled"],null]],[13],[1,"\\n          "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1],["discourse_ai.llms.hints.vision_enabled"],null]]],null],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"control-group ai-llm-editor__enabled-chat-bot"],[12],[1,"\\n          "],[8,[32,2],null,[["@type","@checked"],["checkbox",[30,1,["enabled_chat_bot"]]]],null],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.enabled_chat_bot"],null]],[13],[1,"\\n          "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1],["discourse_ai.llms.hints.enabled_chat_bot"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,1,["user"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.llms.ai_bot_user"],null]],[13],[1,"\\n            "],[10,3],[14,0,"avatar"],[15,6,[30,1,["user","path"]]],[15,"data-user-card",[30,1,["user","username"]]],[12],[1,"\\n              "],[1,[28,[32,11],[[30,1,["user","avatar_template"]],"small"],null]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,12],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n              "],[1,[30,1,["user","username"]]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[10,0],[14,0,"control-group ai-llm-editor__action_panel"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"ai-llm-editor__test"]],[["@action","@disabled","@label"],[[30,0,["test"]],[30,0,["testRunning"]],"discourse_ai.llms.tests.title"]],null],[1,"\\n\\n          "],[8,[32,7],[[24,0,"btn-primary ai-llm-editor__save"]],[["@action","@disabled","@label"],[[30,0,["save"]],[30,0,["isSaving"]],"discourse_ai.llms.save"]],null],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"            "],[8,[32,7],[[24,0,"btn-danger ai-llm-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.llms.delete"]],null],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,0],[14,0,"control-group ai-llm-editor-tests"],[12],[1,"\\n"],[41,[30,0,["displayTestResult"]],[[[41,[30,0,["testRunning"]],[[[1,"            "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.llms.tests.running"],null]],[1,"\\n"]],[]],[[[41,[30,0,["testResult"]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__success"],[12],[1,"\\n                "],[1,[28,[32,0],["check"],null]],[1,"\\n                "],[1,[28,[32,1],["discourse_ai.llms.tests.success"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__failure"],[12],[1,"\\n                "],[1,[28,[32,0],["xmark"],null]],[1,"\\n                "],[1,[30,0,["testErrorMessage"]]],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[]]]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@model","type","field","@llms"],false,["if","unless","each","-each-in","mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form.js",scope:()=>[g.default,h.default,i.Input,y.default,b.default,o.hash,n.on,d.default,o.concat,u.eq,o.get,p.default,r.LinkTo],isStrictMode:!0}),this))()}e.default=w})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor",["exports","@glimmer/component","@ember/object","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(){super(...arguments),this.args.llmTemplate&&this.configurePreset()}configurePreset(){let[e,t]=this.args.llmTemplate.split(/-(.*)/)
if("none"===e)return
const s=this.args.llms.resultSetMeta.presets.findBy("id",e),i=s.models.findBy("name",t)
this.args.model.setProperties({max_prompt_tokens:i.tokens,tokenizer:s.tokenizer,url:i.endpoint||s.endpoint,display_name:i.display_name,name:i.name,provider:s.provider})}static#e=(()=>dt7948.n(this.prototype,"configurePreset",[s.action]))()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"p6PO9Fum",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-llms","discourse_ai.llms.back"]],null],[1,"\\n    "],[8,[32,1],null,[["@model","@llms"],[[30,1],[30,2]]],null],[1,"\\n  "]],["@model","@llms"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/object","@ember-decorators/object","discourse-i18n","select-kit/components/combo-box","select-kit/components/select-kit"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=dt7948.c(class extends o.default{_modelDisabledChanged(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))}static#e=(()=>dt7948.n(this.prototype,"_modelDisabledChanged",[(0,s.observes)("attrs.disabled")]))()
get content(){return[{id:"blank",name:i.default.t("discourse_ai.ai_persona.no_llm_selected")}].concat(this.llms)}static#i=(()=>dt7948.n(this.prototype,"content",[t.computed]))()},[(0,n.selectKitOptions)({filterable:!0})])
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/routing","@ember/service","discourse/components/d-breadcrumbs-item","discourse-common/helpers/i18n","discourse-i18n","admin/components/admin-page-subheader","admin/components/admin-section-landing-item","admin/components/admin-section-landing-wrapper","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[n.service]))()
#D=(()=>{dt7948.i(this,"adminPluginNavManager")})()
static#i=(()=>dt7948.g(this.prototype,"router",[n.service]))()
#T=(()=>{dt7948.i(this,"router")})()
modelDescription(e){let t=""
return t="number"==typeof e.id?`${e.provider}-${e.name}`:e.id.replace(/\./g,"-"),t=`discourse_ai.llms.model_description.${t}`,l.default.lookup(t,{ignoreMissing:!0})?l.default.t(t):""}static#n=(()=>dt7948.n(this.prototype,"modelDescription",[i.action]))()
sanitizedTranslationKey(e){return e.replace(/\./g,"-")}get hasLlmElements(){return 0!==this.args.llms.length}get preconfiguredTitle(){return this.hasLlmElements?"discourse_ai.llms.preconfigured.title":"discourse_ai.llms.preconfigured.title_no_llms"}get preConfiguredLlms(){const e=[{id:"none",name:l.default.t("discourse_ai.llms.preconfigured.fake"),provider:"fake"}],t=this.args.llms.content.map((e=>({provider:e.provider,name:e.name})))
return this.args.llms.resultSetMeta.presets.forEach((s=>{s.models&&s.models.forEach((i=>{const o=`${s.id}-${i.name}`
t.some((e=>e.provider===s.provider&&e.name===i.name))||e.push({id:o,name:i.display_name,provider:s.provider})}))})),e}transitionToLlmEditor(e){this.router.transitionTo("adminPlugins.show.discourse-ai-llms.new",{queryParams:{llmTemplate:e}})}static#r=(()=>dt7948.n(this.prototype,"transitionToLlmEditor",[i.action]))()
localizeUsage(e){return"ai_persona"===e.type?l.default.t("discourse_ai.llms.usage.ai_persona",{persona:e.name}):l.default.t("discourse_ai.llms.usage."+e.type)}static#l=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"nctKcWOi",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-llms"]],[28,[32,1],["discourse_ai.llms.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-llm-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@llms","@llmTemplate"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],[]],[[[41,[30,0,["hasLlmElements"]],[[[1,"          "],[10,"section"],[14,0,"ai-llms-list-editor__configured"],[12],[1,"\\n            "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],["discourse_ai.llms.configured.title","discourse_ai.llms.preconfigured.description","https://meta.discourse.org/t/discourse-ai-large-language-model-llm-settings-page/319903"]],null],[1,"\\n            "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n              "],[10,"thead"],[12],[1,"\\n                "],[10,"tr"],[12],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                  "],[10,"tr"],[15,"data-llm-id",[30,4,["name"]]],[14,0,"ai-llm-list__row d-admin-row__content"],[12],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                      "],[10,0],[14,0,"ai-llm-list__name"],[12],[1,"\\n                        "],[10,"strong"],[12],[1,"\\n                          "],[1,[30,4,["display_name"]]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-llm-list__description"],[12],[1,"\\n                        "],[1,[28,[30,0,["modelDescription"]],[[30,4]],null]],[1,"\\n                      "],[13],[1,"\\n"],[41,[30,4,["used_by"]],[[[1,"                        "],[10,"ul"],[14,0,"ai-llm-list-editor__usages"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,4,["used_by"]]],null]],null],null,[[[1,"                            "],[10,"li"],[12],[1,[28,[30,0,["localizeUsage"]],[[30,5]],null]],[13],[1,"\\n"]],[5]],null],[1,"                        "],[13],[1,"\\n"]],[]],null],[1,"                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                      "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                        "],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[1,"\\n                      "],[13],[1,"\\n                      "],[1,[28,[32,1],[[28,[32,4],["discourse_ai.llms.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                      "],[8,[32,5],[[24,0,"btn btn-default btn-small ai-llm-list__edit-button"]],[["@route","@model"],["adminPlugins.show.discourse-ai-llms.show",[30,4,["id"]]]],[["default"],[[[[1,"\\n                        "],[10,0],[14,0,"d-button-label"],[12],[1,"\\n                          "],[1,[28,[32,1],["discourse_ai.llms.edit"],null]],[1,"\\n                        "],[13],[1,"\\n                      "]],[]]]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[4]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"        "],[10,"section"],[14,0,"ai-llms-list-editor__templates"],[12],[1,"\\n          "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[30,0,["preconfiguredTitle"]],[52,[51,[30,0,["hasLlmElements"]]],"discourse_ai.llms.preconfigured.description"],[52,[51,[30,0,["hasLlmElements"]]],"https://meta.discourse.org/t/discourse-ai-large-language-model-llm-settings-page/319903"]]],null],[1,"\\n\\n          "],[8,[32,6],[[24,0,"ai-llms-list-editor__templates-list"]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["preConfiguredLlms"]]],null]],null],null,[[[1,"              "],[8,[32,7],[[16,"data-llm-id",[30,6,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@descriptionLabelTranslated","@taglineLabel"],[[30,6,["name"]],[28,[30,0,["modelDescription"]],[[30,6]],null],[28,[32,4],["discourse_ai.llms.providers.",[30,6,["provider"]]],null]]],[["buttons"],[[[[1,"\\n                  "],[8,[30,7,["Default"]],null,[["@action","@icon","@label"],[[28,[32,8],[[30,0,["transitionToLlmEditor"]],[30,6,["id"]]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n                "]],[7]]]]],[1,"\\n"]],[6]],null],[1,"          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentLlm","@llms","@llmTemplate","llm","usage","llm","buttons"],false,["if","each","-track-array","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor.js",scope:()=>[a.default,r.default,p.default,c.default,s.concat,o.LinkTo,d.default,u.default,s.fn],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/runloop","@ember/service","discourse/components/back-button","discourse/components/d-button","discourse/components/d-textarea","discourse/components/d-toggle-switch","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/models/group","discourse-i18n","admin/models/admin-user","select-kit/components/combo-box","select-kit/components/group-chooser","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-forced-tool-strategy-selector","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options","discourse/plugins/discourse-ai/discourse/components/ai-tool-selector","discourse/plugins/discourse-ai/discourse/components/rag-options","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f,b,y,v,w,x,k,S,T,M,j,P,C){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class A extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[u.service]))()
#T=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"store",[u.service]))()
#I=(()=>{dt7948.i(this,"store")})()
static#n=(()=>dt7948.g(this.prototype,"dialog",[u.service]))()
#M=(()=>{dt7948.i(this,"dialog")})()
static#r=(()=>dt7948.g(this.prototype,"toasts",[u.service]))()
#S=(()=>{dt7948.i(this,"toasts")})()
static#l=(()=>dt7948.g(this.prototype,"siteSettings",[u.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#c=(()=>dt7948.g(this.prototype,"allGroups",[s.tracked],(function(){return[]})))()
#F=(()=>{dt7948.i(this,"allGroups")})()
static#u=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#j=(()=>{dt7948.i(this,"isSaving")})()
static#d=(()=>dt7948.g(this.prototype,"editingModel",[s.tracked],(function(){return null})))()
#q=(()=>{dt7948.i(this,"editingModel")})()
static#v=(()=>dt7948.g(this.prototype,"showDelete",[s.tracked],(function(){return!1})))()
#B=(()=>{dt7948.i(this,"showDelete")})()
static#w=(()=>dt7948.g(this.prototype,"maxPixelsValue",[s.tracked],(function(){return null})))()
#z=(()=>{dt7948.i(this,"maxPixelsValue")})()
static#x=(()=>dt7948.g(this.prototype,"ragIndexingStatuses",[s.tracked],(function(){return null})))()
#V=(()=>{dt7948.i(this,"ragIndexingStatuses")})()
static#R=(()=>dt7948.g(this.prototype,"selectedTools",[s.tracked],(function(){return[]})))()
#H=(()=>{dt7948.i(this,"selectedTools")})()
static#E=(()=>dt7948.g(this.prototype,"selectedToolNames",[s.tracked],(function(){return[]})))()
#$=(()=>{dt7948.i(this,"selectedToolNames")})()
static#N=(()=>dt7948.g(this.prototype,"forcedToolNames",[s.tracked],(function(){return[]})))()
#Y=(()=>{dt7948.i(this,"forcedToolNames")})()
static#U=(()=>dt7948.g(this.prototype,"hasDefaultLlm",[s.tracked],(function(){return!1})))()
#G=(()=>{dt7948.i(this,"hasDefaultLlm")})()
get chatPluginEnabled(){return this.siteSettings.chat_enabled}get allowForceTools(){return!this.editingModel?.system&&this.selectedToolNames.length>0}get hasForcedTools(){return this.forcedToolNames.length>0}forcedToolsChanged(e){this.forcedToolNames=e,this.editingModel.forcedTools=this.forcedToolNames}static#L=(()=>dt7948.n(this.prototype,"forcedToolsChanged",[n.action]))()
toolsChanged(e){this.selectedTools=this.args.personas.resultSetMeta.tools.filter((t=>e.includes(t.id))),this.selectedToolNames=e.slice(),this.forcedToolNames=this.forcedToolNames.filter((e=>-1!==this.editingModel.tools.indexOf(e))),this.editingModel.tools=this.selectedToolNames,this.editingModel.forcedTools=this.forcedToolNames}static#K=(()=>dt7948.n(this.prototype,"toolsChanged",[n.action]))()
updateModel(){this.editingModel=this.args.model.workingCopy(),this.hasDefaultLlm=!!this.editingModel.default_llm,this.showDelete=!this.args.model.isNew&&!this.args.model.system,this.maxPixelsValue=this.findClosestPixelValue(this.editingModel.vision_max_pixels),this.selectedToolNames=this.editingModel.tools||[],this.selectedTools=this.args.personas.resultSetMeta.tools.filter((e=>this.selectedToolNames.includes(e.id))),this.forcedToolNames=this.editingModel.forcedTools||[]}static#W=(()=>dt7948.n(this.prototype,"updateModel",[n.action]))()
findClosestPixelValue(e){let t="high"
return this.maxPixelValues.forEach((s=>{e===s.pixels&&(t=s.id)})),t}get maxPixelValues(){const e=e=>b.default.t(`discourse_ai.ai_persona.vision_max_pixel_sizes.${e}`)
return[{id:"low",name:e("low"),pixels:65536},{id:"medium",name:e("medium"),pixels:262144},{id:"high",name:e("high"),pixels:1048576}]}static#Q=(()=>dt7948.n(this.prototype,"maxPixelValues",[s.cached]))()
async updateAllGroups(){this.allGroups=await f.default.findAll()}static#X=(()=>dt7948.n(this.prototype,"updateAllGroups",[n.action]))()
async save(){const e=this.args.model.isNew
this.isSaving=!0
const t=this.args.model.workingCopy()
this.args.model.setProperties(this.editingModel)
try{await this.args.model.save(),this.#Z(),e&&0===this.args.model.rag_uploads.length?(this.args.personas.addObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.show",this.args.model)):this.toasts.success({data:{message:b.default.t("discourse_ai.ai_persona.saved")},duration:2e3})}catch(s){this.args.model.setProperties(t),(0,_.popupAjaxError)(s)}finally{(0,c.later)((()=>{this.isSaving=!1}),1e3)}}static#J=(()=>dt7948.n(this.prototype,"save",[n.action]))()
get showTemperature(){return this.editingModel?.temperature||!this.editingModel?.system}get showTopP(){return this.editingModel?.top_p||!this.editingModel?.system}get adminUser(){return y.default.create(this.editingModel?.user)}get mappedQuestionConsolidatorLlm(){return this.editingModel?.question_consolidator_llm||"blank"}set mappedQuestionConsolidatorLlm(e){this.editingModel.question_consolidator_llm="blank"===e?null:e}get mappedDefaultLlm(){return this.editingModel?.default_llm||"blank"}set mappedDefaultLlm(e){"blank"===e?(this.editingModel.default_llm=null,this.hasDefaultLlm=!1):(this.editingModel.default_llm=e,this.hasDefaultLlm=!0)}onChangeMaxPixels(e){const t=this.maxPixelValues.findBy("id",e)
t&&(this.maxPixelsValue=e,this.editingModel.vision_max_pixels=t.pixels)}static#ee=(()=>dt7948.n(this.prototype,"onChangeMaxPixels",[n.action]))()
delete(){return this.dialog.confirm({message:b.default.t("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.personas.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.index")}))})}static#te=(()=>dt7948.n(this.prototype,"delete",[n.action]))()
updateAllowedGroups(e){this.editingModel.set("allowed_group_ids",e)}static#se=(()=>dt7948.n(this.prototype,"updateAllowedGroups",[n.action]))()
async toggleEnabled(){await this.toggleField("enabled")}static#ie=(()=>dt7948.n(this.prototype,"toggleEnabled",[n.action]))()
async togglePriority(){await this.toggleField("priority",!0)}static#oe=(()=>dt7948.n(this.prototype,"togglePriority",[n.action]))()
async createUser(){try{let e=await this.args.model.createUser()
this.editingModel.set("user",e),this.editingModel.set("user_id",e.id)}catch(e){(0,_.popupAjaxError)(e)}}static#ne=(()=>dt7948.n(this.prototype,"createUser",[n.action]))()
updateUploads(e){this.editingModel.rag_uploads=e}static#ae=(()=>dt7948.n(this.prototype,"updateUploads",[n.action]))()
removeUpload(e){this.editingModel.rag_uploads.removeObject(e),this.args.model.isNew||this.save()}static#re=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
async toggleField(e,t){if(this.args.model.set(e,!this.args.model[e]),this.editingModel.set(e,this.args.model[e]),!this.args.model.isNew)try{const s={}
s[e]=this.args.model[e],await this.args.model.update(s),t&&this.#Z()}catch(s){(0,_.popupAjaxError)(s)}}#Z(){const e=this.args.personas.toArray().sort(((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name)))
this.args.personas.clear(),this.args.personas.setObjects(e)}static#le=(()=>(0,i.setComponentTemplate)((0,C.createTemplateFactory)({id:"yqs8reAM",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-personas","discourse_ai.ai_persona.back"]],null],[1,"\\n    "],[11,"form"],[24,0,"form-horizontal ai-persona-editor"],[4,[32,1],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[8,[32,3],[[24,0,"ai-persona-editor__enabled"],[4,[32,4],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,1,["enabled"]],"discourse_ai.ai_persona.enabled"]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__priority"],[12],[1,"\\n        "],[8,[32,3],[[24,0,"ai-persona-editor__priority"],[4,[32,4],["click",[30,0,["togglePriority"]]],null]],[["@state","@label"],[[30,1,["priority"]],"discourse_ai.ai_persona.priority"]],null],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.priority_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,0,"ai-persona-editor__name"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["text",[30,0,["editingModel","name"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.description"],null]],[13],[1,"\\n        "],[8,[32,8],[[24,0,"ai-persona-editor__description"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","description"]]]],null],[1,"      "],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.default_llm"],null]],[13],[1,"\\n          "],[8,[32,9],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms"],[[30,0,["mappedDefaultLlm"]],[30,2,["resultSetMeta","llms"]]]],null],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.default_llm_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["hasDefaultLlm"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,"\\n              "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","force_default_llm"]]]],null],[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.force_default_llm"],null]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]],null],[41,[51,[30,1,["isNew"]]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.user"],null]],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"            "],[10,3],[14,0,"avatar"],[15,6,[30,0,["editingModel","user","path"]]],[15,"data-user-card",[30,0,["editingModel","user","username"]]],[12],[1,"\\n              "],[1,[28,[32,10],[[30,0,["editingModel","user","avatar_template"]],"small"],null]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,11],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n              "],[1,[30,0,["editingModel","user","username"]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],[[[1,"            "],[8,[32,12],[[24,0,"ai-persona-editor__create-user"]],[["@action"],[[30,0,["createUser"]]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.create_user"],null]],[1,"\\n            "]],[]]]]],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.create_user_help"],null]]],null],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.tools"],null]],[13],[1,"\\n        "],[8,[32,13],[[24,0,"ai-persona-editor__tools"]],[["@value","@disabled","@tools","@onChange"],[[30,0,["selectedToolNames"]],[30,0,["editingModel","system"]],[30,2,["resultSetMeta","tools"]],[30,0,["toolsChanged"]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["allowForceTools"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.forced_tools"],null]],[13],[1,"\\n          "],[8,[32,13],[[24,0,"ai-persona-editor__forced_tools"]],[["@value","@tools","@onChange"],[[30,0,["forcedToolNames"]],[30,0,["selectedTools"]],[30,0,["forcedToolsChanged"]]]],null],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["hasForcedTools"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.forced_tool_strategy"],null]],[13],[1,"\\n            "],[8,[32,14],[[24,0,"ai-persona-editor__forced_tool_strategy"]],[["@value"],[[30,0,["editingModel","forced_tool_count"]]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]],null],[41,[51,[30,0,["editingModel","system"]]],[[[1,"        "],[8,[32,15],null,[["@persona","@tools","@allTools"],[[30,0,["editingModel"]],[30,0,["selectedToolNames"]],[30,2,["resultSetMeta","tools"]]]],null],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allowed_groups"],null]],[13],[1,"\\n        "],[8,[32,16],null,[["@value","@content","@onChange"],[[30,0,["editingModel","allowed_group_ids"]],[30,0,["allGroups"]],[30,0,["updateAllowedGroups"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[14,"for","ai-persona-editor__system_prompt"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.system_prompt"],null]],[13],[1,"\\n        "],[8,[32,8],[[24,0,"ai-persona-editor__system_prompt"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","system_prompt"]]]],null],[1,"      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__allow_personal_messages"],[12],[1,"\\n        "],[10,"label"],[12],[1,"\\n          "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","allow_personal_messages"]]]],null],[1,"\\n          "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_personal_messages"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_personal_messages_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"        "],[10,0],[14,0,"control-group ai-persona-editor__allow_topic_mentions"],[12],[1,"\\n          "],[10,"label"],[12],[1,"\\n            "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","allow_topic_mentions"]]]],null],[1,"\\n            "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_topic_mentions"],null]],[13],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_topic_mentions_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["chatPluginEnabled"]],[[[1,"          "],[10,0],[14,0,"control-group ai-persona-editor__allow_chat_direct_messages"],[12],[1,"\\n            "],[10,"label"],[12],[1,"\\n              "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","allow_chat_direct_messages"]]]],null],[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat_direct_messages"],null]],[13],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat_direct_messages_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"control-group ai-persona-editor__allow_chat_channel_mentions"],[12],[1,"\\n            "],[10,"label"],[12],[1,"\\n              "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","allow_chat_channel_mentions"]]]],null],[1,"\\n              "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat_channel_mentions"],null]],[13],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.allow_chat_channel_mentions_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-persona-editor__tool-details"],[12],[1,"\\n        "],[10,"label"],[12],[1,"\\n          "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","tool_details"]]]],null],[1,"\\n          "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.tool_details"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.tool_details_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__vision_enabled"],[12],[1,"\\n        "],[10,"label"],[12],[1,"\\n          "],[8,[32,7],null,[["@type","@checked"],["checkbox",[30,0,["editingModel","vision_enabled"]]]],null],[1,"\\n          "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_enabled"],null]],[13],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_enabled_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["editingModel","vision_enabled"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.vision_max_pixels"],null]],[13],[1,"\\n          "],[8,[32,17],null,[["@value","@content","@onChange"],[[30,0,["maxPixelsValue"]],[30,0,["maxPixelValues"]],[30,0,["onChangeMaxPixels"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.max_context_posts"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,"lang","en"],[24,0,"ai-persona-editor__max_context_posts"]],[["@type","@value"],["number",[30,0,["editingModel","max_context_posts"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.max_context_posts_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["showTemperature"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.temperature"],null]],[13],[1,"\\n          "],[8,[32,7],[[24,0,"ai-persona-editor__temperature"],[24,"step","any"],[24,"lang","en"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","temperature"]]]],null],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.temperature_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showTopP"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.top_p"],null]],[13],[1,"\\n          "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__top_p"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","top_p"]]]],null],[1,"\\n          "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.top_p_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[8,[32,18],null,[["@target","@updateUploads","@onRemove"],[[30,0,["editingModel"]],[30,0,["updateUploads"]],[30,0,["removeUpload"]]]],null],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,19],null,[["@model"],[[30,0,["editingModel"]]]],[["default"],[[[[1,"\\n          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_conversation_chunks"],null]],[13],[1,"\\n            "],[8,[32,7],[[24,"step","any"],[24,"lang","en"],[24,0,"ai-persona-editor__rag_conversation_chunks"]],[["@type","@value"],["number",[30,0,["editingModel","rag_conversation_chunks"]]]],null],[1,"\\n            "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.rag_conversation_chunks_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.question_consolidator_llm"],null]],[13],[1,"\\n            "],[8,[32,9],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms"],[[30,0,["mappedQuestionConsolidatorLlm"]],[30,2,["resultSetMeta","llms"]]]],null],[1,"\\n\\n            "],[8,[32,5],null,[["@icon","@content"],["circle-question",[28,[32,6,["t"]],["discourse_ai.ai_persona.question_consolidator_llm_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-persona-editor__action_panel"],[12],[1,"\\n        "],[8,[32,12],[[24,0,"btn-primary ai-persona-editor__save"]],[["@action","@disabled"],[[30,0,["save"]],[30,0,["isSaving"]]]],[["default"],[[[[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.save"],null]]],[]]]]],[1,"\\n"],[41,[30,0,["showDelete"]],[[[1,"          "],[8,[32,12],[[24,0,"btn-danger ai-persona-editor__delete"]],[["@action"],[[30,0,["delete"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,6,["t"]],["discourse_ai.ai_persona.delete"],null]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@model","@personas"],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[d.default,r.default,a.default,g.default,o.on,x.default,b.default,i.Input,m.default,S.default,h.default,l.LinkTo,p.default,M.default,k.default,T.default,w.default,v.default,P.default,j.default],isStrictMode:!0}),this))()}e.default=A})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-toggle-switch","discourse/helpers/concat-class","discourse/lib/ajax-error","discourse-common/helpers/i18n","admin/components/admin-config-area-empty-list","admin/components/admin-page-subheader","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[a.service]))()
#D=(()=>{dt7948.i(this,"adminPluginNavManager")})()
async toggleEnabled(e){const t=e.enabled,s=!t
try{e.set("enabled",s),await e.save()}catch(i){e.set("enabled",t),(0,u.popupAjaxError)(i)}}static#i=(()=>dt7948.n(this.prototype,"toggleEnabled",[o.action]))()
static#n=(()=>(0,h.setComponentTemplate)((0,_.createTemplateFactory)({id:"Tnx6nuZU",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-personas"]],[28,[32,1],["discourse_ai.ai_persona.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-persona-list-editor__current admin-detail pull-left"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],["discourse_ai.ai_persona.short_title","discourse_ai.ai_persona.persona_description","https://meta.discourse.org/t/ai-bot-personas/306099"]],[["actions"],[[[[1,"\\n            "],[8,[30,3,["Primary"]],[[24,0,"ai-persona-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","plus"]],null],[1,"\\n          "]],[3]]]]],[1,"\\n\\n"],[41,[30,2],[[[1,"          "],[10,"table"],[14,0,"content-list ai-persona-list-editor d-admin-table"],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.enabled"],null]],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                "],[10,"tr"],[15,"data-persona-id",[30,4,["id"]]],[15,0,[28,[32,4],["ai-persona-list__row d-admin-row__content",[52,[30,4,["priority"]],"priority"]],null]],[12],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-persona-list__name-with-description"],[12],[1,"\\n                      "],[10,0],[14,0,"ai-persona-list__name"],[12],[1,"\\n                        "],[10,"strong"],[12],[1,"\\n                          "],[1,[30,4,["name"]]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-persona-list__description"],[12],[1,"\\n                        "],[1,[30,4,["description"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                    "],[8,[32,5],[[4,[32,6],["click",[28,[32,7],[[30,0,["toggleEnabled"]],[30,4]],null]],null]],[["@state"],[[30,4,["enabled"]]]],null],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                    "],[8,[32,8],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.show",[30,4]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.ai_persona.edit"],null]],[1," "]],[]]]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[4]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,9],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","ai-persona-list-editor__empty-new-button","discourse_ai.ai_persona.no_personas"]],null],[1,"\\n"]],[]]]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentPersona","@personas","actions","persona"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[r.default,d.default,g.default,m.default,c.default,l.default,i.on,s.fn,n.LinkTo,p.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor",["exports","@glimmer/component","@ember/component","@ember/modifier","@ember/object","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{get isBoolean(){return"boolean"===this.args.option.type}get selectedValue(){return"true"===this.args.option.value.value}onCheckboxChange(e){this.args.option.value.value=e.target.checked?"true":"false"}static#e=(()=>dt7948.n(this.prototype,"onCheckboxChange",[o.action]))()
static#i=(()=>(0,s.setComponentTemplate)((0,n.createTemplateFactory)({id:"3m5ogwIV",block:'[[[1,"\\n    "],[10,0],[14,0,"control-group ai-persona-tool-option-editor"],[12],[1,"\\n      "],[10,"label"],[12],[1,"\\n        "],[1,[30,1,["name"]]],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,""],[12],[1,"\\n"],[41,[30,0,["isBoolean"]],[[[1,"          "],[11,"input"],[16,"checked",[30,0,["selectedValue"]]],[24,4,"checkbox"],[4,[32,0],["click",[30,0,["onCheckboxChange"]]],null],[12],[13],[1,"\\n          "],[1,[30,1,["description"]]],[1,"\\n"]],[]],[[[1,"          "],[8,[32,1],null,[["@value"],[[30,1,["value","value"]]]],null],[1,"\\n"]],[]]],[1,"      "],[13],[1,"\\n"],[41,[51,[30,0,["isBoolean"]]],[[[1,"        "],[10,0],[14,0,"ai-persona-tool-option-editor__instructions"],[12],[1,"\\n          "],[1,[30,1,["description"]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@option"],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor.js",scope:()=>[i.on,s.Input],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options",["exports","@glimmer/component","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-option-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{get showToolOptions(){const e=this.args.allTools
return!!e&&this.toolNames.any((t=>e.findBy("id",t)?.options))}get toolNames(){return this.args.tools?this.args.tools.map((e=>"string"==typeof e?e:e[0])):[]}get toolOptions(){if(!this.args.tools)return[]
const e=this.args.allTools
if(!e)return[]
const t=[]
return this.toolNames.forEach((s=>{const i=e.findBy("id",s),o=i?.name,n=i?.options
if(n){const e=Object.keys(n).map((e=>{const t=this.args.persona.getToolOption(s,e)
return Object.assign({},n[e],{id:e,value:t})}))
t.push({toolName:o,options:e})}})),t}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"Z0blnyXN",block:'[[[1,"\\n"],[41,[30,0,["showToolOptions"]],[[[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.tool_options"],null]],[13],[1,"\\n        "],[10,0],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["toolOptions"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"ai-persona-editor__tool-options"],[12],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__tool-options-name"],[12],[1,"\\n                "],[1,[30,1,["toolName"]]],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__tool-option-options"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,1,["options"]]],null]],null],null,[[[1,"                  "],[8,[32,1],null,[["@option"],[[30,2]]],null],[1,"\\n"]],[2]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["toolOption","option"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options.js",scope:()=>[s.default,i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/will-destroy","@ember/service","ember-modifier","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/text","discourse/lib/utilities","discourse-common/utils/decorators","discourse-i18n","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f,b,y,v,w,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class S extends t.default{static#e=(()=>dt7948.g(this.prototype,"messageBus",[a.service]))()
#ce=(()=>{dt7948.i(this,"messageBus")})()
static#i=(()=>dt7948.g(this.prototype,"site",[a.service]))()
#h=(()=>{dt7948.i(this,"site")})()
static#n=(()=>dt7948.g(this.prototype,"modal",[a.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
static#r=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#l=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#c=(()=>dt7948.g(this.prototype,"menu",[a.service]))()
#ue=(()=>{dt7948.i(this,"menu")})()
static#u=(()=>dt7948.g(this.prototype,"tooltip",[a.service]))()
#de=(()=>{dt7948.i(this,"tooltip")})()
static#d=(()=>dt7948.g(this.prototype,"menuState",[s.tracked],(function(){return this.MENU_STATES.options})))()
#pe=(()=>{dt7948.i(this,"menuState")})()
static#v=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#w=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#ge=(()=>{dt7948.i(this,"suggestion")})()
static#x=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#b=(()=>{dt7948.i(this,"customPromptValue")})()
static#R=(()=>dt7948.g(this.prototype,"copyButtonIcon",[s.tracked],(function(){return"copy"})))()
#he=(()=>{dt7948.i(this,"copyButtonIcon")})()
static#E=(()=>dt7948.g(this.prototype,"copyButtonLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.post_options_menu.copy"})))()
#_e=(()=>{dt7948.i(this,"copyButtonLabel")})()
static#N=(()=>dt7948.g(this.prototype,"showFastEdit",[s.tracked],(function(){return!1})))()
#fe=(()=>{dt7948.i(this,"showFastEdit")})()
static#U=(()=>dt7948.g(this.prototype,"showAiButtons",[s.tracked],(function(){return!0})))()
#be=(()=>{dt7948.i(this,"showAiButtons")})()
static#L=(()=>dt7948.g(this.prototype,"streaming",[s.tracked],(function(){return!1})))()
#ye=(()=>{dt7948.i(this,"streaming")})()
static#K=(()=>dt7948.g(this.prototype,"lastSelectedOption",[s.tracked],(function(){return null})))()
#ve=(()=>{dt7948.i(this,"lastSelectedOption")})()
static#W=(()=>dt7948.g(this.prototype,"isSavingFootnote",[s.tracked],(function(){return!1})))()
#we=(()=>{dt7948.i(this,"isSavingFootnote")})()
static#Q=(()=>dt7948.g(this.prototype,"supportsAddFootnote",[s.tracked],(function(){return this.args.data.supportsFastEdit})))()
#xe=(()=>{dt7948.i(this,"supportsAddFootnote")})()
MENU_STATES={options:"OPTIONS",loading:"LOADING",result:"RESULT"}
showFootnoteTooltip=(()=>(0,r.modifier)((e=>{if(this.supportsAddFootnote||this.streaming)return
const t=this.tooltip.register(e,{identifier:"cannot-add-footnote-tooltip",content:b.default.t("discourse_ai.ai_helper.post_options_menu.footnote_disabled"),placement:"top",triggers:"hover"})
return()=>{t.destroy()}})))()
static#X=(()=>dt7948.g(this.prototype,"_activeAiRequest",[s.tracked],(function(){return null})))()
#ke=(()=>{dt7948.i(this,"_activeAiRequest")})()
get footnoteDisabled(){return this.streaming||!this.supportsAddFootnote}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("post")))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),this.args.data.canEditPost||(e=e.filter((e=>"proofread"!==e.name))),e}get highlightedTextToggleIcon(){return this.showHighlightedText?"angle-double-left":"angle-double-right"}get allowInsertFootnote(){const e=this.siteSettings,t=this.args.data.canEditPost
return!!(e?.enable_markdown_footnotes&&e?.display_footnotes_inline&&t)&&"explain"===this.lastSelectedOption?.name}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}_sanitizeForFootnote(e){return e=(e=(e=e.replace(/[\r\n]+/g," ")).replace(/^(#+)\s+/gm,"")).trim(),(0,h.sanitize)(e)}subscribe(){const e=`/discourse-ai/ai-helper/stream_suggestion/${this.args.data.quoteState.postId}`
this.messageBus.subscribe(e,this._updateResult)}static#J=(()=>dt7948.n(this.prototype,"subscribe",[f.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-helper/stream_suggestion/*",this._updateResult)}static#ee=(()=>dt7948.n(this.prototype,"unsubscribe",[f.bind]))()
_updateResult(e){this.streaming=!e.done,this.suggestion=e.result}static#te=(()=>dt7948.n(this.prototype,"_updateResult",[f.bind]))()
toggleHighlightedTextPreview(){this.showHighlightedText=!this.showHighlightedText}static#se=(()=>dt7948.n(this.prototype,"toggleHighlightedTextPreview",[i.action]))()
async performAiSuggestion(e){this.menuState=this.MENU_STATES.loading,this.lastSelectedOption=e
return["explain","translate","custom_prompt"].includes(e.name)?this._handleStreamedResult(e):(this._activeAiRequest=(0,m.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.id,text:this.args.data.quoteState.buffer,custom_prompt:this.customPromptValue}}),this._activeAiRequest.then((t=>{let{suggestions:s}=t
if(this.suggestion=s[0].trim(),"proofread"===e.name)return this._handleProofreadOption()})).catch(g.popupAjaxError).finally((()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})),this._activeAiRequest)}static#ie=(()=>dt7948.n(this.prototype,"performAiSuggestion",[i.action]))()
_handleStreamedResult(e){this.menuState=this.MENU_STATES.result
const t=this.menu.getByIdentifier("post-text-selection-toolbar")
t&&(t.options.placement="bottom")
return this._activeAiRequest=(0,m.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{mode:e.id,text:this.args.data.selectedText,post_id:this.args.data.quoteState.postId,custom_prompt:this.customPromptValue}}),this._activeAiRequest}_handleProofreadOption(){return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(p.default,{model:{initialValue:this.args.data.quoteState.buffer,newValue:this.suggestion,post:this.args.data.post,close:this.closeFastEdit}})}cancelAiAction(){this._activeAiRequest&&(this._activeAiRequest.abort(),this._activeAiRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}static#oe=(()=>dt7948.n(this.prototype,"cancelAiAction",[i.action]))()
copySuggestion(){this.suggestion?.length>0&&((0,_.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout((()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"}),3500))}static#ne=(()=>dt7948.n(this.prototype,"copySuggestion",[i.action]))()
closeMenu(){if(this.site.mobileView)return this.args.close()
const e=this.menu.getByIdentifier("post-text-selection-toolbar")
return e?.close()}static#ae=(()=>dt7948.n(this.prototype,"closeMenu",[i.action]))()
async closeFastEdit(){this.showFastEdit=!1,await this.args.data.hideToolbar()}static#re=(()=>dt7948.n(this.prototype,"closeFastEdit",[i.action]))()
async insertFootnote(){if(this.isSavingFootnote=!0,this.allowInsertFootnote)try{const e=await(0,m.ajax)(`/posts/${this.args.data.post.id}`),t=this._sanitizeForFootnote(this.suggestion),s=b.default.t("discourse_ai.ai_helper.post_options_menu.footnote_credits"),i=`${this.args.data.selectedText} ^[${t} (${s})]`,o=e.raw.replace(this.args.data.selectedText,i)
await this.args.data.post.save({raw:o})}catch(e){(0,g.popupAjaxError)(e)}finally{this.isSavingFootnote=!1,await this.closeMenu()}}static#le=(()=>dt7948.n(this.prototype,"insertFootnote",[i.action]))()
static#Se=(()=>(0,x.setComponentTemplate)((0,k.createTemplateFactory)({id:"/g+fRewr",block:'[[[1,"\\n"],[41,[28,[32,0],[[30,0,["site","mobileView"]],[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null]],null],[[[1,"      "],[10,0],[14,0,"ai-post-helper-menu__selected-text"],[12],[1,"\\n        "],[1,[30,1,["selectedText"]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[8,[32,2],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["performAiSuggestion"]],false]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"          "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"          "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,4],[[30,0,["subscribe"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"              "],[10,0],[14,0,"ai-post-helper__suggestion__text"],[14,"dir","auto"],[12],[1,"\\n                "],[8,[32,6],null,[["@rawText"],[[30,0,["suggestion"]]]],null],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n                "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["xmark","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAiAction"]]]],null],[1,"\\n                "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[30,0,["streaming"]]]],null],[1,"\\n"],[41,[30,0,["allowInsertFootnote"]],[[[1,"                  "],[8,[32,7],[[24,0,"btn-flat ai-post-helper__suggestion__insert-footnote"],[4,[30,0,["showFootnoteTooltip"]],null,null]],[["@icon","@label","@action","@isLoading","@disabled"],["asterisk","discourse_ai.ai_helper.post_options_menu.insert_footnote",[30,0,["insertFootnote"]],[30,0,["isSavingFootnote"]],[30,0,["footnoteDisabled"]]]],null],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]],[[[1,"              "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "]],[]],null]],[]]]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n        "],[8,[32,8],null,[["@initialValue","@newValue","@post","@close"],[[30,1,["quoteState","buffer"]],[30,0,["suggestion"]],[30,1,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu.js",scope:()=>[l.and,y.default,w.default,v.default,o.default,n.default,c.default,u.default,d.default],isStrictMode:!0}),this))()}e.default=S})),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[a.service]))()
#h=(()=>{dt7948.i(this,"site")})()
static#i=(()=>dt7948.g(this.prototype,"menu",[a.service]))()
#ue=(()=>{dt7948.i(this,"menu")})()
static#n=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return[]})))()
#Te=(()=>{dt7948.i(this,"suggestions")})()
static#r=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#l=(()=>dt7948.g(this.prototype,"icon",[s.tracked],(function(){return"discourse-sparkles"})))()
#Me=(()=>{dt7948.i(this,"icon")})()
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
get input(){return this.args.selectedPosts.map((e=>e.cooked)).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,c.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then((e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map((e=>e.name)),s=this.site.categories.filter((e=>t.includes(e.name.toLowerCase())))
this.suggestions=s}else this.args.mode===this.SUGGESTION_TYPES.tag&&(this.suggestions=e.assistant.map((e=>({name:e.name,count:e.count}))))})).catch(u.popupAjaxError).finally((()=>{this.loading=!1})))}static#c=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else{const t=[this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else this.args.updateAction(e)
return t.close()}}}static#u=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
static#d=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"4ZszHd3J",block:'[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[1,"    "],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n      "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"              "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n                "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n                "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                  "],[1,[30,3,["totalTopicCount"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[41,[28,[32,3],[[30,1],"suggest_tags"],null],[[[1,"              "],[10,"li"],[15,"data-name",[30,3,["name"]]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3,["name"]],[28,[32,4],[[30,0,["applySuggestion"]],[30,3,["name"]],[30,2]],null]]],[["default"],[[[[1,"\\n                  "],[10,1],[14,0,"topic-count"],[12],[1,"x"],[1,[30,3,["count"]]],[13],[1,"\\n                "]],[]]]]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "]],[]]]],[]]]],[3,4]],null]],[]],null],[1,"      "],[13],[1,"\\n    "]],[2]]]]],[1,"\\n  "]],["@mode","menu","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[r.default,d.default,o.on,p.default,i.fn,l.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","discourse/helpers/concat-class","discourse-common/helpers/i18n","discourse-common/lib/later","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h{static#e=(()=>dt7948.g(this.prototype,"show",[s.tracked],(function(){return!1})))()
#je=(()=>{dt7948.i(this,"show")})()
static#i=(()=>dt7948.g(this.prototype,"shown",[s.tracked],(function(){return!1})))()
#Pe=(()=>{dt7948.i(this,"shown")})()
static#n=(()=>dt7948.g(this.prototype,"blinking",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"blinking")})()
constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}
this.show=e.show??!1,this.shown=e.shown??!1}}class _ extends t.default{blocks=(()=>[...Array.from({length:20},(()=>new h))])()
#Ae
#Oe
#Re
setupAnimation(){this.blocks.firstObject.show=!0,this.blocks.firstObject.shown=!0}static#e=(()=>dt7948.n(this.prototype,"setupAnimation",[o.action]))()
onBlinking(e){e.blinking&&(e.show=!1,this.#Ae=(0,d.default)(this,(()=>{this.#Ee(e).blinking=!0}),250),this.#Oe=(0,d.default)(this,(()=>{e.blinking=!1}),500))}static#i=(()=>dt7948.n(this.prototype,"onBlinking",[o.action]))()
onShowing(e){e.show&&(this.#Re=(0,d.default)(this,(()=>{this.#Ee(e).show=!0,this.#Ee(e).shown=!0,this.blocks.lastObject===e&&(this.blocks.firstObject.blinking=!0)}),250))}static#n=(()=>dt7948.n(this.prototype,"onShowing",[o.action]))()
teardownAnimation(){(0,l.cancel)(this.#Re),(0,l.cancel)(this.#Ae),(0,l.cancel)(this.#Oe)}static#r=(()=>dt7948.n(this.prototype,"teardownAnimation",[o.action]))()
#Ee(e){return e===this.blocks.lastObject?this.blocks.firstObject:this.blocks.objectAt(this.blocks.indexOf(e)+1)}static#l=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"nyQgIgwk",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-summary__container"],[12],[1,"\\n      "],[11,"ul"],[24,0,"ai-summary__list"],[4,[32,0],[[30,0,["setupAnimation"]]],null],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["blocks"]]],null]],null],null,[[[1,"          "],[11,"li"],[16,0,[28,[32,1],["ai-summary__list-item",[52,[30,1,["show"]],"show"],[52,[30,1,["shown"]],"is-shown"],[52,[30,1,["blinking"]],"blink"]],null]],[4,[32,2],[[28,[32,3],[[30,0,["onBlinking"]],[30,1]],null],[30,1,["blinking"]]],null],[4,[32,2],[[28,[32,3],[[30,0,["onShowing"]],[30,1]],null],[30,1,["show"]]],null],[4,[32,4],[[30,0,["teardownAnimation"]]],null],[12],[13],[1,"\\n"]],[1]],null],[1,"      "],[13],[1,"\\n\\n      "],[10,1],[12],[1,"\\n        "],[10,0],[14,0,"ai-summary__generating-text"],[12],[1,"\\n          "],[1,[28,[32,5],["summary.in_progress"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,6],null,[["@loading"],[true]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["block"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton.js",scope:()=>[n.default,c.default,a.default,i.fn,r.default,u.default,p.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/service","discourse/components/ace-editor","discourse/components/back-button","discourse/components/d-button","discourse/components/d-tooltip","discourse/helpers/with-event-value","discourse/lib/ajax-error","discourse-i18n","select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor","discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal","discourse/plugins/discourse-ai/discourse/components/rag-options","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f,b,y,v,w,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[l.service]))()
#T=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"dialog",[l.service]))()
#M=(()=>{dt7948.i(this,"dialog")})()
static#n=(()=>dt7948.g(this.prototype,"modal",[l.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
static#r=(()=>dt7948.g(this.prototype,"toasts",[l.service]))()
#S=(()=>{dt7948.i(this,"toasts")})()
static#l=(()=>dt7948.g(this.prototype,"store",[l.service]))()
#I=(()=>{dt7948.i(this,"store")})()
static#c=(()=>dt7948.g(this.prototype,"siteSettings",[l.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#u=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#j=(()=>{dt7948.i(this,"isSaving")})()
static#d=(()=>dt7948.g(this.prototype,"editingModel",[s.tracked],(function(){return null})))()
#q=(()=>{dt7948.i(this,"editingModel")})()
static#v=(()=>dt7948.g(this.prototype,"showDelete",[s.tracked],(function(){return!1})))()
#B=(()=>{dt7948.i(this,"showDelete")})()
static#w=(()=>dt7948.g(this.prototype,"selectedPreset",[s.tracked],(function(){return null})))()
#Ne=(()=>{dt7948.i(this,"selectedPreset")})()
get presets(){return this.args.presets.map((e=>({name:e.preset_name,id:e.preset_id})))}get showPresets(){return!this.selectedPreset&&this.args.model.isNew}updateModel(){this.editingModel=this.args.model.workingCopy(),this.showDelete=!this.args.model.isNew}static#x=(()=>dt7948.n(this.prototype,"updateModel",[n.action]))()
configurePreset(){this.selectedPreset=this.args.presets.findBy("preset_id",this.presetId),this.editingModel=this.store.createRecord("ai-tool",this.selectedPreset).workingCopy(),this.showDelete=!1}static#R=(()=>dt7948.n(this.prototype,"configurePreset",[n.action]))()
updateUploads(e){this.editingModel.rag_uploads=e}static#E=(()=>dt7948.n(this.prototype,"updateUploads",[n.action]))()
removeUpload(e){this.editingModel.rag_uploads.removeObject(e),this.args.model.isNew||this.save()}static#N=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
async save(){this.isSaving=!0
try{const e=this.editingModel.getProperties("name","description","parameters","script","summary","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens")
await this.args.model.save(e),this.toasts.success({data:{message:h.default.t("discourse_ai.tools.saved")},duration:2e3}),this.args.tools.any((e=>e.id===this.args.model.id))||this.args.tools.pushObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.show",this.args.model)}catch(e){(0,g.popupAjaxError)(e)}finally{this.isSaving=!1}}static#U=(()=>dt7948.n(this.prototype,"save",[n.action]))()
delete(){return this.dialog.confirm({message:h.default.t("discourse_ai.tools.confirm_delete"),didConfirm:async()=>{await this.args.model.destroyRecord(),this.args.tools.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.index")}})}static#L=(()=>dt7948.n(this.prototype,"delete",[n.action]))()
openTestModal(){this.modal.show(b.default,{model:{tool:this.editingModel}})}static#K=(()=>dt7948.n(this.prototype,"openTestModal",[n.action]))()
static#W=(()=>(0,w.setComponentTemplate)((0,x.createTemplateFactory)({id:"XIuAJKyQ",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-tools","discourse_ai.tools.back"]],null],[1,"\\n\\n    "],[11,"form"],[24,0,"form-horizontal ai-tool-editor"],[4,[32,1],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,2],[[30,0,["updateModel"]],[30,1,["id"]]],null],[12],[1,"\\n"],[41,[30,0,["showPresets"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.presets"],null]],[13],[1,"\\n          "],[8,[32,4],[[24,0,"ai-tool-editor__presets"]],[["@value","@content"],[[30,0,["presetId"]],[30,0,["presets"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group ai-llm-editor__action_panel"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"ai-tool-editor__next"]],[["@action","@label"],[[30,0,["configurePreset"]],"discourse_ai.tools.next.title"]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.name"],null]],[13],[1,"\\n          "],[11,"input"],[16,2,[30,0,["editingModel","name"]]],[24,0,"ai-tool-editor__name"],[24,4,"text"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","name"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,9],null,[["@icon","@content"],["circle-question",[28,[32,3,["t"]],["discourse_ai.tools.name_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.description"],null]],[13],[1,"\\n          "],[11,"textarea"],[16,"placeholder",[28,[32,3,["t"]],["discourse_ai.tools.description_help"],null]],[24,0,"ai-tool-editor__description input-xxlarge"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","description"]]],null]],null]],null]],null],[12],[1,[30,0,["editingModel","description"]]],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.summary"],null]],[13],[1,"\\n          "],[11,"input"],[16,2,[30,0,["editingModel","summary"]]],[24,0,"ai-tool-editor__summary input-xxlarge"],[24,4,"text"],[4,[32,6],["input",[28,[32,7],[[28,[32,8],[[28,[31,1],[[30,0,["editingModel","summary"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,9],null,[["@icon","@content"],["circle-question",[28,[32,3,["t"]],["discourse_ai.tools.summary_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.parameters"],null]],[13],[1,"\\n          "],[8,[32,10],null,[["@parameters"],[[30,0,["editingModel","parameters"]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,3,["t"]],["discourse_ai.tools.script"],null]],[13],[1,"\\n          "],[8,[32,11],null,[["@content","@onChange","@mode","@theme","@editorId"],[[30,0,["editingModel","script"]],[28,[32,8],[[28,[31,1],[[30,0,["editingModel","script"]]],null]],null],[32,12],[32,13],"ai-tool-script-editor"]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[8,[32,14],null,[["@target","@updateUploads","@onRemove"],[[30,0,["editingModel"]],[30,0,["updateUploads"]],[30,0,["removeUpload"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,15],null,[["@model"],[[30,0,["editingModel"]]]],null],[1,"\\n"]],[]],null],[1,"\\n        "],[10,0],[14,0,"control-group ai-tool-editor__action_panel"],[12],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"            "],[8,[32,5],[[24,0,"ai-tool-editor__test-button"]],[["@action","@label"],[[30,0,["openTestModal"]],"discourse_ai.tools.test"]],null],[1,"\\n"]],[]],null],[1,"\\n          "],[8,[32,5],[[24,0,"btn-primary ai-tool-editor__save"]],[["@action","@label","@disabled"],[[30,0,["save"]],"discourse_ai.tools.save",[30,0,["isSaving"]]]],null],[1,"\\n\\n"],[41,[30,0,["showDelete"]],[[[1,"            "],[8,[32,5],[[24,0,"btn-danger ai-tool-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.tools.delete"]],null],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@model"],false,["if","mut","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor.js",scope:()=>[u.default,a.default,r.default,h.default,_.default,d.default,o.on,m.default,i.fn,p.default,f.default,c.default,"javascript","chrome",v.default,y.default],isStrictMode:!0}),this))()}e.default=k}))
define("discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor",["exports","@glimmer/component","@ember/routing","@ember/service","discourse/components/d-breadcrumbs-item","discourse-common/helpers/i18n","discourse-i18n","admin/components/admin-config-area-empty-list","admin/components/admin-page-subheader","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[i.service]))()
#D=(()=>{dt7948.i(this,"adminPluginNavManager")})()
static#i=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"a1dhFle1",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-tools"]],[28,[32,1],["discourse_ai.tools.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-tool-list-editor__current admin-detail pull-left"],[12],[1,"\\n      "],[8,[32,2],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],["discourse_ai.tools.short_title","https://meta.discourse.org/t/ai-bot-custom-tools/314103","discourse_ai.tools.subheader_description"]],[["actions"],[[[[1,"\\n          "],[8,[30,1,["Primary"]],[[24,0,"ai-tool-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.tools.new","adminPlugins.show.discourse-ai-tools.new","plus"]],null],[1,"\\n        "]],[1]]]]],[1,"\\n\\n"],[41,[30,2],[[[1,"        "],[10,"table"],[14,0,"d-admin-table ai-tool-list-editor"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.tools.name"],null]],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"              "],[10,"tr"],[15,"data-tool-id",[30,3,["id"]]],[14,0,"ai-tool-list__row d-admin-row__content"],[12],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                  "],[10,0],[14,0,"ai-tool-list__name-with-description"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,3,["name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__description"],[12],[1,"\\n                      "],[1,[30,3,["description"]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                  "],[8,[32,3],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-tools.show",[30,3]]],[["default"],[[[[1,[28,[32,4,["t"]],["discourse_ai.tools.edit"],null]]],[]]]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[3]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[8,[32,5],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.tools.new","adminPlugins.show.discourse-ai-tools.new","ai-tool-list-editor__empty-new-button","discourse_ai.tools.no_tools"]],null],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["actions","@tools","tool"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor.js",scope:()=>[o.default,n.default,l.default,s.LinkTo,a.default,r.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember-compat/tracked-built-ins","discourse/components/d-button","discourse/helpers/with-event-value","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=[{name:"string",id:"string"},{name:"number",id:"number"},{name:"boolean",id:"boolean"},{name:"array",id:"array"}]
class m extends t.default{addParameter(){this.args.parameters.push(new n.TrackedObject({name:"",description:"",type:"string",required:!1,enum:null}))}static#e=(()=>dt7948.n(this.prototype,"addParameter",[o.action]))()
removeParameter(e){const t=this.args.parameters.indexOf(e)
this.args.parameters.splice(t,1)}static#i=(()=>dt7948.n(this.prototype,"removeParameter",[o.action]))()
toggleRequired(e,t){e.required=t.target.checked}static#n=(()=>dt7948.n(this.prototype,"toggleRequired",[o.action]))()
toggleEnum(e){e.enum?e.enum=null:this.addEnumValue(e)}static#r=(()=>dt7948.n(this.prototype,"toggleEnum",[o.action]))()
addEnumValue(e){e.enum||=new n.TrackedArray,e.enum.push("")}static#l=(()=>dt7948.n(this.prototype,"addEnumValue",[o.action]))()
removeEnumValue(e,t){e.enum.splice(t,1),0===e.enum.length&&(e.enum=null)}static#c=(()=>dt7948.n(this.prototype,"removeEnumValue",[o.action]))()
updateEnumValue(e,t,s){e.enum[t]=s.target.value}static#u=(()=>dt7948.n(this.prototype,"updateEnumValue",[o.action]))()
static#d=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"92COowYe",block:'[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[1,"      "],[10,0],[14,0,"ai-tool-parameter"],[12],[1,"\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,2,["name"]]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.parameter_name"],null]],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,2],[[30,2,["name"]]],null]],null]],null]],null],[12],[13],[1,"\\n          "],[8,[32,4],null,[["@value","@content"],[[30,2,["type"]],[32,5]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,2,["description"]]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.parameter_description"],null]],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,2],[[30,2,["description"]]],null]],null]],null]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"parameter-row"],[12],[1,"\\n          "],[10,"label"],[12],[1,"\\n            "],[11,"input"],[16,"checked",[30,2,["required"]]],[24,0,"parameter-row__required-toggle"],[24,4,"checkbox"],[4,[32,1],["input",[28,[32,3],[[30,0,["toggleRequired"]],[30,2]],null]],null],[12],[13],[1,"\\n            "],[1,[28,[32,0,["t"]],["discourse_ai.tools.parameter_required"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,"label"],[12],[1,"\\n            "],[11,"input"],[16,"checked",[30,2,["enum"]]],[24,0,"parameter-row__enum-toggle"],[24,4,"checkbox"],[4,[32,1],["input",[28,[32,3],[[30,0,["toggleEnum"]],[30,2]],null]],null],[12],[13],[1,"\\n            "],[1,[28,[32,0,["t"]],["discourse_ai.tools.parameter_enum"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,6],[[24,0,"btn-danger"]],[["@action","@icon"],[[28,[32,3],[[30,0,["removeParameter"]],[30,2]],null],"trash-can"]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,2,["enum"]],[[[1,"          "],[10,0],[14,0,"parameter-enum-values"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["enum"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"enum-value-row"],[12],[1,"\\n                "],[11,"input"],[16,2,[30,3]],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.tools.enum_value"],null]],[24,4,"text"],[4,[32,1],["change",[28,[32,3],[[30,0,["updateEnumValue"]],[30,2],[30,4]],null]],null],[12],[13],[1,"\\n                "],[8,[32,6],[[24,0,"btn-danger"]],[["@action","@icon"],[[28,[32,3],[[30,0,["removeEnumValue"]],[30,2],[30,4]],null],"trash-can"]],null],[1,"\\n              "],[13],[1,"\\n"]],[3,4]],null],[1,"\\n            "],[8,[32,6],null,[["@action","@label","@icon"],[[28,[32,3],[[30,0,["addEnumValue"]],[30,2]],null],"discourse_ai.tools.add_enum_value","plus"]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n"]],[2]],null],[1,"\\n    "],[8,[32,6],null,[["@action","@label","@icon"],[[30,0,["addParameter"]],"discourse_ai.tools.add_parameter","plus"]],null],[1,"\\n  "]],["@parameters","parameter","enumValue","enumIndex"],false,["each","-track-array","mut","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-parameter-editor.js",scope:()=>[l.default,i.on,r.default,s.fn,c.default,p,a.default],isStrictMode:!0}),this))()}e.default=m})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-selector",["exports","@ember/object/computed","@ember-decorators/object","select-kit/components/multi-select","select-kit/components/select-kit"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=dt7948.c(class extends i.default{static#e=(()=>dt7948.g(this.prototype,"content",[(0,t.readOnly)("tools")]))()
#Ue=(()=>{dt7948.i(this,"content")})()
value=""
_modelDisabledChanged(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))}static#i=(()=>dt7948.n(this.prototype,"_modelDisabledChanged",[(0,s.observes)("attrs.disabled")]))()},[(0,o.selectKitOptions)({filterable:!0})])
e.default=n})),define("discourse/plugins/discourse-ai/discourse/components/ai-topic-gist",["exports","@glimmer/component","@ember/service","@ember/template","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"gists",[s.service]))()
#k=(()=>{dt7948.i(this,"gists")})()
get shouldShow(){return"table-ai"===this.gists.preference&&this.gists.shouldShow}get hasGist(){return!!this.gist}get gist(){return this.args.topic.get("ai_topic_gist")}get escapedExcerpt(){return this.args.topic.get("escapedExcerpt")}static#i=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"DDbV96Wf",block:'[[[1,"\\n"],[41,[30,0,["shouldShow"]],[[[41,[30,0,["hasGist"]],[[[1,"        "],[10,0],[14,0,"excerpt"],[12],[1,"\\n          "],[10,0],[14,0,"excerpt__contents"],[12],[1,[30,0,["gist"]]],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[41,[30,0,["escapedExcerpt"]],[[[1,"          "],[10,0],[14,0,"excerpt"],[12],[1,"\\n            "],[10,0],[14,0,"excerpt__contents"],[12],[1,"\\n              "],[1,[28,[32,0],[[30,0,["escapedExcerpt"]]],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]]]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-topic-gist.js",scope:()=>[i.htmlSafe],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-usage",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","truth-helpers","discourse/components/date-time-input-range","discourse/helpers/avatar","discourse/lib/ajax","discourse-common/helpers/i18n","admin/components/chart","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"store",[r.service]))()
#I=(()=>{dt7948.i(this,"store")})()
static#i=(()=>dt7948.g(this.prototype,"startDate",[s.tracked],(function(){return moment().subtract(30,"days").toDate()})))()
#Le=(()=>{dt7948.i(this,"startDate")})()
static#n=(()=>dt7948.g(this.prototype,"endDate",[s.tracked],(function(){return new Date})))()
#De=(()=>{dt7948.i(this,"endDate")})()
static#r=(()=>dt7948.g(this.prototype,"data",[s.tracked],(function(){return this.args.model})))()
#Ie=(()=>{dt7948.i(this,"data")})()
static#l=(()=>dt7948.g(this.prototype,"selectedFeature",[s.tracked]))()
#Fe=(()=>{dt7948.i(this,"selectedFeature")})()
static#c=(()=>dt7948.g(this.prototype,"selectedModel",[s.tracked]))()
#qe=(()=>{dt7948.i(this,"selectedModel")})()
static#u=(()=>dt7948.g(this.prototype,"selectedPeriod",[s.tracked],(function(){return"month"})))()
#Be=(()=>{dt7948.i(this,"selectedPeriod")})()
static#d=(()=>dt7948.g(this.prototype,"isCustomDateActive",[s.tracked],(function(){return!1})))()
#ze=(()=>{dt7948.i(this,"isCustomDateActive")})()
async fetchData(){const e=await(0,d.ajax)("/admin/plugins/discourse-ai/ai-usage.json",{data:{start_date:moment(this.startDate).format("YYYY-MM-DD"),end_date:moment(this.endDate).format("YYYY-MM-DD"),feature:this.selectedFeature,model:this.selectedModel}})
this.data=e}static#v=(()=>dt7948.n(this.prototype,"fetchData",[n.action]))()
async onFilterChange(){await this.fetchData()}static#w=(()=>dt7948.n(this.prototype,"onFilterChange",[n.action]))()
onFeatureChanged(e){this.selectedFeature=e,this.onFilterChange()}static#x=(()=>dt7948.n(this.prototype,"onFeatureChanged",[n.action]))()
onModelChanged(e){this.selectedModel=e,this.onFilterChange()}static#R=(()=>dt7948.n(this.prototype,"onModelChanged",[n.action]))()
normalizeTimeSeriesData(e){if(!e?.length)return[]
const t=moment(this.startDate),s=moment(this.endDate),i=[]
let o,n
"hour"===this.data.period?(o="hour",n="YYYY-MM-DD HH:00:00"):"day"===this.data.period?(o="day",n="YYYY-MM-DD"):(o="month",n="YYYY-MM")
const a=new Map(e.map((e=>[moment(e.period).format(n),e])))
for(let r=moment(t);r.isSameOrBefore(s);r.add(1,o)){const e=r.format(n),t=a.get(e)
i.push(t||{period:r.format(),total_tokens:0,total_cached_tokens:0,total_request_tokens:0,total_response_tokens:0})}return i}get chartConfig(){if(!this.data?.data)return
const e=this.normalizeTimeSeriesData(this.data.data),t=document.querySelector(".ai-usage__chart"),s=getComputedStyle(t),i={response:s.getPropertyValue("--chart-response-color").trim(),request:s.getPropertyValue("--chart-request-color").trim(),cached:s.getPropertyValue("--chart-cached-color").trim()}
return{type:"bar",data:{labels:e.map((e=>{const t=moment(e.period)
return"hour"===this.data.period?t.format("HH:00"):"day"===this.data.period?t.format("DD-MMM"):t.format("MMM-YY")})),datasets:[{label:"Response Tokens",data:e.map((e=>e.total_response_tokens)),backgroundColor:i.response},{label:"Net Request Tokens",data:e.map((e=>e.total_request_tokens-e.total_cached_tokens)),backgroundColor:i.request},{label:"Cached Request Tokens",data:e.map((e=>e.total_cached_tokens)),backgroundColor:i.cached}]},options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}}}get availableFeatures(){return this._cachedFeatures=this._cachedFeatures||(this.data?.features||[]).map((e=>({id:e.feature_name,name:e.feature_name}))),this._cachedFeatures}get availableModels(){return this._cachedModels=this._cachedModels||(this.data?.models||[]).map((e=>({id:e.llm,name:e.llm}))),this._cachedModels}get periodOptions(){return[{id:"day",name:"Last 24 Hours"},{id:"week",name:"Last Week"},{id:"month",name:"Last Month"}]}setPeriodDates(e){const t=moment()
switch(e){case"day":this.startDate=t.clone().subtract(1,"day").toDate(),this.endDate=t.toDate()
break
case"week":this.startDate=t.clone().subtract(7,"days").toDate(),this.endDate=t.toDate()
break
case"month":this.startDate=t.clone().subtract(30,"days").toDate(),this.endDate=t.toDate()}}static#E=(()=>dt7948.n(this.prototype,"setPeriodDates",[n.action]))()
onPeriodSelect(e){this.selectedPeriod=e,this.isCustomDateActive=!1,this.setPeriodDates(e),this.fetchData()}static#N=(()=>dt7948.n(this.prototype,"onPeriodSelect",[n.action]))()
onCustomDateClick(){this.isCustomDateActive=!this.isCustomDateActive,this.isCustomDateActive&&(this.selectedPeriod=null)}static#U=(()=>dt7948.n(this.prototype,"onCustomDateClick",[n.action]))()
onDateChange(){this.isCustomDateActive=!0,this.selectedPeriod=null,this.fetchData()}static#L=(()=>dt7948.n(this.prototype,"onDateChange",[n.action]))()
onChangeDateRange(e){let{from:t,to:s}=e
this._startDate=t,this._endDate=s}static#K=(()=>dt7948.n(this.prototype,"onChangeDateRange",[n.action]))()
onRefreshDateRange(){this.startDate=this._startDate,this.endDate=this._endDate,this.fetchData()}static#W=(()=>dt7948.n(this.prototype,"onRefreshDateRange",[n.action]))()
static#Q=(()=>(0,h.setComponentTemplate)((0,_.createTemplateFactory)({id:"937Mc91T",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-usage"],[12],[1,"\\n      "],[10,0],[14,0,"ai-usage__filters"],[12],[1,"\\n\\n        "],[10,0],[14,0,"ai-usage__filters-dates"],[12],[1,"\\n          "],[10,0],[14,0,"ai-usage__period-buttons"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["periodOptions"]]],null]],null],null,[[[1,"              "],[11,"button"],[16,0,[29,["btn\\n                  ",[52,[28,[32,0],[[30,0,["selectedPeriod"]],[30,1,["id"]]],null],"btn-primary","btn-default"]]]],[24,4,"button"],[4,[32,1],["click",[28,[32,2],[[30,0,["onPeriodSelect"]],[30,1,["id"]]],null]],null],[12],[1,"\\n                "],[1,[30,1,["name"]]],[1,"\\n              "],[13],[1,"\\n"]],[1]],null],[1,"            "],[11,"button"],[16,0,[29,["btn\\n                ",[52,[30,0,["isCustomDateActive"]],"btn-primary","btn-default"]]]],[24,4,"button"],[4,[32,1],["click",[30,0,["onCustomDateClick"]]],null],[12],[1,"\\n              Custom...\\n            "],[13],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["isCustomDateActive"]],[[[1,"            "],[10,0],[14,0,"ai-usage__custom-date-pickers"],[12],[1,"\\n\\n              "],[8,[32,3],null,[["@from","@to","@onChange","@showFromTime","@showToTime"],[[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["onChangeDateRange"]],false,false]],null],[1,"\\n\\n              "],[11,"button"],[24,0,"btn btn-default"],[24,4,"button"],[4,[32,1],["click",[30,0,["onRefreshDateRange"]]],null],[12],[1,"\\n                "],[1,[28,[32,4],["refresh"],null]],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-usage__filters-row"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"ai-usage__feature-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedFeature"]],[30,0,["availableFeatures"]],[30,0,["onFeatureChanged"]],[28,[32,6],null,[["none"],["discourse_ai.usage.all_features"]]]]],null],[1,"\\n\\n          "],[8,[32,5],[[24,0,"ai-usage__model-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedModel"]],[30,0,["availableModels"]],[30,0,["onModelChanged"]],[28,[32,6],null,[["none"],["discourse_ai.usage.all_models"]]]]],null],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["data"]],[[[1,"          "],[10,0],[14,0,"ai-usage__summary"],[12],[1,"\\n            "],[10,"h3"],[14,0,"ai-usage__summary-title"],[12],[1,"\\n              "],[1,[28,[32,4],["discourse_ai.usage.summary"],null]],[1,"\\n            "],[13],[1,"\\n            "],[10,0],[14,0,"ai-usage__summary-stats"],[12],[1,"\\n              "],[10,0],[14,0,"ai-usage__summary-stat"],[12],[1,"\\n                "],[10,1],[14,0,"label"],[12],[1,[28,[32,4],["discourse_ai.usage.total_requests"],null]],[13],[1,"\\n                "],[10,1],[14,0,"value"],[12],[1,[30,0,["data","summary","total_requests"]]],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-usage__summary-stat"],[12],[1,"\\n                "],[10,1],[14,0,"label"],[12],[1,[28,[32,4],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                "],[10,1],[14,0,"value"],[12],[1,[30,0,["data","summary","total_tokens"]]],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-usage__summary-stat"],[12],[1,"\\n                "],[10,1],[14,0,"label"],[12],[1,[28,[32,4],["discourse_ai.usage.request_tokens"],null]],[13],[1,"\\n                "],[10,1],[14,0,"value"],[12],[1,[30,0,["data","summary","total_request_tokens"]]],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-usage__summary-stat"],[12],[1,"\\n                "],[10,1],[14,0,"label"],[12],[1,[28,[32,4],["discourse_ai.usage.response_tokens"],null]],[13],[1,"\\n                "],[10,1],[14,0,"value"],[12],[1,[30,0,["data","summary","total_response_tokens"]]],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-usage__summary-stat"],[12],[1,"\\n                "],[10,1],[14,0,"label"],[12],[1,[28,[32,4],["discourse_ai.usage.cached_tokens"],null]],[13],[1,"\\n                "],[10,1],[14,0,"value"],[12],[1,[30,0,["data","summary","total_cached_tokens"]]],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"ai-usage__charts"],[12],[1,"\\n            "],[10,0],[14,0,"ai-usage__chart-container"],[12],[1,"\\n              "],[10,"h3"],[14,0,"ai-usage__chart-title"],[12],[1,"\\n                "],[1,[28,[32,4],["discourse_ai.usage.tokens_over_time"],null]],[1,"\\n              "],[13],[1,"\\n              "],[8,[32,7],[[24,0,"ai-usage__chart"]],[["@chartConfig"],[[30,0,["chartConfig"]]]],null],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"ai-usage__breakdowns"],[12],[1,"\\n\\n              "],[10,0],[14,0,"ai-usage__users"],[12],[1,"\\n                "],[10,"h3"],[14,0,"ai-usage__users-title"],[12],[1,"\\n                  "],[1,[28,[32,4],["discourse_ai.usage.users_breakdown"],null]],[1,"\\n                "],[13],[1,"\\n                "],[10,"table"],[14,0,"ai-usage__users-table"],[12],[1,"\\n                  "],[10,"thead"],[12],[1,"\\n                    "],[10,"tr"],[12],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.username"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","users"]]],null]],null],null,[[[1,"                      "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                          "],[10,0],[14,0,"user-info"],[12],[1,"\\n                            "],[8,[32,8],[[24,0,"username"]],[["@route","@model"],["user",[30,2,["username"]]]],[["default"],[[[[1,"\\n                              "],[1,[28,[32,9],[[30,2]],[["imageSize"],["tiny"]]]],[1,"\\n                              "],[1,[30,2,["username"]]],[1,"\\n                            "]],[]]]]],[1,"\\n                          "],[13],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,[30,2,["usage_count"]]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,[30,2,["total_tokens"]]],[13],[1,"\\n                      "],[13],[1,"\\n"]],[2]],null],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n\\n              "],[10,0],[14,0,"ai-usage__features"],[12],[1,"\\n                "],[10,"h3"],[14,0,"ai-usage__features-title"],[12],[1,"\\n                  "],[1,[28,[32,4],["discourse_ai.usage.features_breakdown"],null]],[1,"\\n                "],[13],[1,"\\n                "],[10,"table"],[14,0,"ai-usage__features-table"],[12],[1,"\\n                  "],[10,"thead"],[12],[1,"\\n                    "],[10,"tr"],[12],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.feature"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","features"]]],null]],null],null,[[[1,"                      "],[10,"tr"],[14,0,"ai-usage__features-row"],[12],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,3,["feature_name"]]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,3,["usage_count"]]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,3,["total_tokens"]]],[13],[1,"\\n                      "],[13],[1,"\\n"]],[3]],null],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n\\n              "],[10,0],[14,0,"ai-usage__models"],[12],[1,"\\n                "],[10,"h3"],[14,0,"ai-usage__models-title"],[12],[1,"\\n                  "],[1,[28,[32,4],["discourse_ai.usage.models_breakdown"],null]],[1,"\\n                "],[13],[1,"\\n                "],[10,"table"],[14,0,"ai-usage__models-table"],[12],[1,"\\n                  "],[10,"thead"],[12],[1,"\\n                    "],[10,"tr"],[12],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.model"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                      "],[10,"th"],[12],[1,[28,[32,4],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","models"]]],null]],null],null,[[[1,"                      "],[10,"tr"],[14,0,"ai-usage__models-row"],[12],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,4,["llm"]]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,4,["usage_count"]]],[13],[1,"\\n                        "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,4,["total_tokens"]]],[13],[1,"\\n                      "],[13],[1,"\\n"]],[4]],null],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["option","user","feature","model"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-usage.js",scope:()=>[l.eq,o.on,i.fn,c.default,p.default,g.default,i.hash,m.default,a.LinkTo,u.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","@ember/service","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/helpers/html-class","discourse/lib/ajax","discourse/lib/formatter","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse-common/utils/decorators","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f,b,y,v,w,x,k,S,T){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class M extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[c.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"messageBus",[c.service]))()
#ce=(()=>{dt7948.i(this,"messageBus")})()
static#n=(()=>dt7948.g(this.prototype,"currentUser",[c.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#r=(()=>dt7948.g(this.prototype,"site",[c.service]))()
#h=(()=>{dt7948.i(this,"site")})()
static#l=(()=>dt7948.g(this.prototype,"modal",[c.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
static#c=(()=>dt7948.g(this.prototype,"text",[s.tracked],(function(){return""})))()
#Ve=(()=>{dt7948.i(this,"text")})()
static#u=(()=>dt7948.g(this.prototype,"summarizedOn",[s.tracked],(function(){return null})))()
#He=(()=>{dt7948.i(this,"summarizedOn")})()
static#d=(()=>dt7948.g(this.prototype,"summarizedBy",[s.tracked],(function(){return null})))()
#$e=(()=>{dt7948.i(this,"summarizedBy")})()
static#v=(()=>dt7948.g(this.prototype,"newPostsSinceSummary",[s.tracked],(function(){return null})))()
#Ye=(()=>{dt7948.i(this,"newPostsSinceSummary")})()
static#w=(()=>dt7948.g(this.prototype,"outdated",[s.tracked],(function(){return!1})))()
#Ge=(()=>{dt7948.i(this,"outdated")})()
static#x=(()=>dt7948.g(this.prototype,"canRegenerate",[s.tracked],(function(){return!1})))()
#Ke=(()=>{dt7948.i(this,"canRegenerate")})()
static#R=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#E=(()=>dt7948.g(this.prototype,"isStreaming",[s.tracked],(function(){return!1})))()
#We=(()=>{dt7948.i(this,"isStreaming")})()
static#N=(()=>dt7948.g(this.prototype,"streamedText",[s.tracked],(function(){return""})))()
#Qe=(()=>{dt7948.i(this,"streamedText")})()
static#U=(()=>dt7948.g(this.prototype,"currentIndex",[s.tracked],(function(){return 0})))()
#Xe=(()=>{dt7948.i(this,"currentIndex")})()
typingTimer=null
streamedTextLength=0
get outdatedSummaryWarningText(){let e=w.default.t("summary.outdated")
return!this.topRepliesSummaryEnabled&&this.newPostsSinceSummary>0&&(e+=" ",e+=w.default.t("summary.outdated_posts",{count:this.newPostsSinceSummary})),e}resetSummary(){this.streamedText="",this.currentIndex=0,this.text="",this.summarizedOn=null,this.summarizedBy=null,this.newPostsSinceSummary=null,this.outdated=!1,this.canRegenerate=!1,this.loading=!1,this._channel=null}get topRepliesSummaryEnabled(){return this.args.model.postStream.summary}get topicId(){return this.args.model.topic.id}get baseSummarizationURL(){return`/discourse-ai/summarization/t/${this.topicId}`}subscribe(){const e=`/discourse-ai/summaries/topic/${this.args.model.topic.id}`
this._channel=e,this.messageBus.subscribe(e,this._updateSummary)}static#L=(()=>dt7948.n(this.prototype,"subscribe",[v.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/summaries/topic/*",this._updateSummary),this.resetSummary()}static#K=(()=>dt7948.n(this.prototype,"unsubscribe",[v.bind]))()
generateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true"),this._requestSummary(e)}static#W=(()=>dt7948.n(this.prototype,"generateSummary",[o.action]))()
regenerateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true",this.canRegenerate&&(e+="&skip_age_check=true")),this.resetSummary(),this._requestSummary(e)}static#Q=(()=>dt7948.n(this.prototype,"regenerateSummary",[o.action]))()
_requestSummary(e){if(!(this.loading||this.text&&!this.canRegenerate))return this.loading=!0,this.summarizedOn=null,(0,_.ajax)(e).then((e=>{e?.ai_topic_summary?.summarized_text&&(e.done=!0,this._updateSummary(e))}))}static#X=(()=>dt7948.n(this.prototype,"_requestSummary",[o.action]))()
typeCharacter(){this.streamedTextLength<this.text.length?(this.streamedText+=this.text.charAt(this.streamedTextLength),this.streamedTextLength++,this.typingTimer=(0,l.later)(this,this.typeCharacter,15)):this.typingTimer=null}onTextUpdate(){this.typingTimer&&(0,l.cancel)(this.typingTimer),this.typeCharacter()}async _updateSummary(e){const t={done:e.done,raw:e.ai_topic_summary?.summarized_text,...e.ai_topic_summary},s=t.raw||""
this.loading=!1,e.done?(this.text=s,this.streamedText=s,this.displayedTextLength=s.length,this.isStreaming=!1,this.summarizedOn=(0,f.shortDateNoYear)(moment(t.updated_at,"YYYY-MM-DD HH:mm:ss Z")),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.canRegenerate=t.outdated&&t.can_regenerate,this.typingTimer&&((0,l.cancel)(this.typingTimer),this.typingTimer=null)):s.length>this.text.length&&(this.text=s,this.isStreaming=!0,this.onTextUpdate())}static#J=(()=>dt7948.n(this.prototype,"_updateSummary",[v.bind]))()
onRegisterApi(e){this.dMenu=e}static#ee=(()=>dt7948.n(this.prototype,"onRegisterApi",[o.action]))()
handleClose(){this.modal.triggerElement=null,this.args.closeModal()}static#te=(()=>dt7948.n(this.prototype,"handleClose",[o.action]))()
static#se=(()=>(0,S.setComponentTemplate)((0,T.createTemplateFactory)({id:"FY6znZCF",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-summary-modal"],[4,[32,3],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,4],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null]],[["@title","@closeModal","@bodyClass","@hideFooter"],[[28,[32,1],["discourse_ai.summarization.topic.title"],null],[30,0,["handleClose"]],"ai-summary-modal__body",[28,[32,2],[[30,0,["summarizedOn"]]],null]]],[["body","footer"],[[[[1,"\\n        "],[1,[28,[32,6],["scrollable-modal"],null]],[1,"\\n        "],[11,0],[24,0,"ai-summary-container"],[4,[32,3],[[30,0,["generateSummary"]]],null],[12],[1,"\\n          "],[10,"article"],[15,0,[28,[32,7],["ai-summary-box","streamable-content",[52,[30,0,["isStreaming"]],"streaming"]],null]],[12],[1,"\\n"],[41,[30,0,["loading"]],[[[1,"              "],[8,[32,8],null,null,null],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"generated-summary cooked"],[12],[1,"\\n                "],[8,[32,9],null,[["@rawText"],[[30,0,["streamedText"]]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,2],[14,0,"summarized-on"],[12],[1,"\\n          "],[1,[28,[32,1],["summary.summarized_on"],[["date"],[[30,0,["summarizedOn"]]]]]],[1,"\\n          "],[8,[32,10],null,[["@placements"],[[28,[32,11],["top-end"],null]]],[["trigger","content"],[[[[1,"\\n              "],[1,[28,[32,12],["circle-info"],null]],[1,"\\n            "]],[]],[[[1,"\\n              "],[1,[28,[32,1],["summary.model_used"],[["model"],[[30,0,["summarizedBy"]]]]]],[1,"\\n            "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["outdated"]],[[[1,"          "],[10,2],[14,0,"summary-outdated"],[12],[1,[30,0,["outdatedSummaryWarningText"]]],[13],[1,"\\n"]],[]],null],[41,[30,0,["canRegenerate"]],[[[1,"          "],[8,[32,13],null,[["@label","@title","@action","@icon"],["summary.buttons.regenerate","summary.buttons.regenerate",[30,0,["regenerateSummary"]],"arrows-rotate"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal.js",scope:()=>[m.default,y.default,u.not,n.default,a.default,r.default,h.default,g.default,k.default,d.default,x.default,i.array,b.default,p.default],isStrictMode:!0}),this))()}e.default=M})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"testResult",[s.tracked]))()
#C=(()=>{dt7948.i(this,"testResult")})()
static#i=(()=>dt7948.g(this.prototype,"isLoading",[s.tracked],(function(){return!1})))()
#Ze=(()=>{dt7948.i(this,"isLoading")})()
parameterValues={}
updateParameter(e,t){this.parameterValues[e]=t.target.value}static#n=(()=>dt7948.n(this.prototype,"updateParameter",[n.action]))()
async runTest(){this.isLoading=!0
try{const e=await(0,l.ajax)(`/admin/plugins/discourse-ai/ai-tools/${this.args.model.tool.id}/test.json`,{type:"POST",data:JSON.stringify({ai_tool:this.args.model.tool,parameters:this.parameterValues}),contentType:"application/json"})
this.testResult=(0,d.jsonToHtml)(e.output)}catch(e){(0,c.popupAjaxError)(e)}finally{this.isLoading=!1}}static#r=(()=>dt7948.n(this.prototype,"runTest",[n.action]))()
static#l=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"aClC59Lc",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1,["t"]],["discourse_ai.tools.test_modal.title"],null],[30,1],"ai-tool-test-modal__body"]],[["body","footer"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["tool","parameters"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[30,3,["name"]]],[13],[1,"\\n            "],[11,"input"],[16,3,[30,3,["name"]]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[30,0,["updateParameter"]],[30,3,["name"]]],null]],null],[12],[13],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"ai-tool-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1,["t"]],["discourse_ai.tools.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[12],[1,[30,0,["testResult"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary ai-tool-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.tools.test_modal.run",[30,0,["isLoading"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model","param"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal.js",scope:()=>[r.default,u.default,o.on,i.fn,a.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/conditional-loading-section","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"chatApi",[o.service]))()
#Je=(()=>{dt7948.i(this,"chatApi")})()
static#i=(()=>dt7948.g(this.prototype,"sinceHours",[s.tracked],(function(){return null})))()
#et=(()=>{dt7948.i(this,"sinceHours")})()
static#n=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#r=(()=>dt7948.g(this.prototype,"summary",[s.tracked],(function(){return null})))()
#tt=(()=>{dt7948.i(this,"summary")})()
availableSummaries={}
sinceOptions=[1,3,6,12,24,72,168].map((e=>({name:d.default.t("discourse_ai.summarization.chat.since",{count:e}),value:e})))
get channelId(){return this.args.model.channelId}summarize(e){return this.sinceHours=e,this.loading=!0,this.availableSummaries[e]?(this.summary=this.availableSummaries[e],void(this.loading=!1)):(0,l.ajax)(`/discourse-ai/summarization/channels/${this.channelId}.json`,{type:"GET",data:{since:e}}).then((e=>{this.availableSummaries[this.sinceHours]=e.summary,this.summary=this.availableSummaries[this.sinceHours]})).catch(c.popupAjaxError).finally((()=>this.loading=!1))}static#l=(()=>dt7948.n(this.prototype,"summarize",[i.action]))()
static#c=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"ye9ZWC9O",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"chat-modal-channel-summary"]],[["@closeModal","@title"],[[30,1],[28,[32,1],["discourse_ai.summarization.chat.title"],null]]],[["body","footer"],[[[[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.summarization.chat.description"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,0,"summarization-since"]],[["@value","@content","@onChange","@valueProperty"],[[30,0,["sinceHours"]],[30,0,["sinceOptions"]],[30,0,["summarize"]],"value"]],null],[1,"\\n        "],[8,[32,3],null,[["@isLoading"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,2],[14,0,"summary-area"],[12],[1,[30,0,["summary"]]],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary.js",scope:()=>[a.default,u.default,p.default,n.default,r.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/runloop","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/helpers/i18n","discourse-common/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class b extends t.default{static#e=(()=>dt7948.g(this.prototype,"info",[s.tracked],(function(){return null})))()
#st=(()=>{dt7948.i(this,"info")})()
static#i=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#it=(()=>{dt7948.i(this,"justCopiedText")})()
static#n=(()=>dt7948.g(this.prototype,"activeTab",[s.tracked],(function(){return"request"})))()
#ot=(()=>{dt7948.i(this,"activeTab")})()
constructor(){super(...arguments),(0,n.next)((()=>{this.loadApiRequestInfo()}))}get htmlContext(){if(!this.info)return""
let e
try{if("request"!==this.activeTab)return this.formattedResponse(this.info.raw_response_payload)
e=JSON.parse(this.info.raw_request_payload)}catch{return this.info.raw_request_payload}return(0,h.jsonToHtml)(e)}formattedResponse(e){const t=e.split("\n").map((e=>(0,d.escapeExpression)(e))).join("<br>")
return(0,a.htmlSafe)(t)}copyRequest(){this.copy(this.info.raw_request_payload)}static#r=(()=>dt7948.n(this.prototype,"copyRequest",[o.action]))()
copyResponse(){this.copy(this.info.raw_response_payload)}static#l=(()=>dt7948.n(this.prototype,"copyResponse",[o.action]))()
async loadLog(e){try{await(0,c.ajax)(`/discourse-ai/ai-bot/show-debug-info/${e}.json`).then((e=>{this.info=e}))}catch(t){(0,u.popupAjaxError)(t)}}prevLog(){this.loadLog(this.info.prev_log_id)}static#c=(()=>dt7948.n(this.prototype,"prevLog",[o.action]))()
nextLog(){this.loadLog(this.info.next_log_id)}static#u=(()=>dt7948.n(this.prototype,"nextLog",[o.action]))()
copy(e){(0,d.clipboardCopy)(e),this.justCopiedText=g.default.t("discourse_ai.ai_bot.conversation_shared"),(0,m.default)((()=>{this.justCopiedText=""}),2e3)}loadApiRequestInfo(){(0,c.ajax)(`/discourse-ai/ai-bot/post/${this.args.model.id}/show-debug-info.json`).then((e=>{this.info=e})).catch((e=>{(0,u.popupAjaxError)(e)}))}get requestActive(){return"request"===this.activeTab?"active":""}get responseActive(){return"response"===this.activeTab?"active":""}requestClicked(e){this.activeTab="request",e.preventDefault()}static#d=(()=>dt7948.n(this.prototype,"requestClicked",[o.action]))()
responseClicked(e){this.activeTab="response",e.preventDefault()}static#v=(()=>dt7948.n(this.prototype,"responseClicked",[o.action]))()
static#w=(()=>(0,_.setComponentTemplate)((0,f.createTemplateFactory)({id:"xMX9mYY4",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-debug-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,"ul"],[14,0,"nav nav-pills ai-debug-modal__nav"],[12],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["requestActive"]]],[4,[32,2],["click",[30,0,["requestClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request"],null]],[13],[13],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["responseActive"]]],[4,[32,2],["click",[30,0,["responseClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response"],null]],[13],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-debug-modal__tokens"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","request_tokens"]]],[1,"\\n          "],[13],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","response_tokens"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"debug-ai-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyRequest"]],"discourse_ai.ai_bot.debug_ai_modal.copy_request"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyResponse"]],"discourse_ai.ai_bot.debug_ai_modal.copy_response"]],null],[1,"\\n"],[41,[30,0,["info","prev_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-left",[30,0,["prevLog"]],"discourse_ai.ai_bot.debug_ai_modal.previous_log"]],null],[1,"\\n"]],[]],null],[41,[30,0,["info","next_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-right",[30,0,["nextLog"]],"discourse_ai.ai_bot.debug_ai_modal.next_log"]],null],[1,"\\n"]],[]],null],[1,"        "],[10,1],[14,0,"ai-debut-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal.js",scope:()=>[l.default,p.default,i.on,r.default],isStrictMode:!0}),this))()}e.default=b})),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","@ember/template","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[o.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#n=(()=>dt7948.g(this.prototype,"diff",[s.tracked]))()
#f=(()=>{dt7948.i(this,"diff")})()
static#r=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#ge=(()=>{dt7948.i(this,"suggestion")})()
constructor(){super(...arguments),this.suggestChanges()}async suggestChanges(){this.loading=!0
try{const e=await(0,c.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.args.model.mode,text:this.args.model.selectedText,custom_prompt:this.args.model.customPromptValue,force_default_locale:!0}})
this.diff=e.diff,this.suggestion=e.suggestions[0]}catch(e){(0,u.popupAjaxError)(e)}finally{this.loading=!1}}static#l=(()=>dt7948.n(this.prototype,"suggestChanges",[i.action]))()
triggerConfirmChanges(){this.args.closeModal(),this.suggestion&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,this.suggestion)}static#c=(()=>dt7948.n(this.prototype,"triggerConfirmChanges",[i.action]))()
static#u=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"1RHJPtPu",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"          "],[10,0],[14,0,"composer-ai-helper-modal__loading"],[12],[1,"\\n            "],[8,[32,2],null,[["@rawText"],[[30,2,["selectedText"]]]],null],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[41,[30,0,["diff"]],[[[1,"            "],[1,[28,[32,3],[[30,0,["diff"]]],null]],[1,"\\n"]],[]],[[[1,"            "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,"\\n              "],[1,[30,2,["selectedText"]]],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n              "],[1,[30,0,["suggestion"]]],[1,"\\n            "],[13],[1,"\\n"]],[]]]],[]]],[1,"\\n      "]],[]],[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"          "],[8,[32,4],[[24,0,"btn-primary"]],[["@label","@disabled"],["discourse_ai.ai_helper.context_menu.loading",true]],[["default"],[[[[1,"\\n            "],[8,[32,5],null,[["@loading"],[[30,0,["loading"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],[[[1,"          "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@action","@label"],[[30,0,["triggerConfirmChanges"]],"discourse_ai.ai_helper.context_menu.confirm"]],null],[1,"\\n          "],[8,[32,4],[[24,0,"btn-flat discard"]],[["@action","@label"],[[30,1],"discourse_ai.ai_helper.context_menu.discard"]],null],[1,"\\n          "],[8,[32,4],[[24,0,"regenerate"]],[["@icon","@action","@label"],["arrows-rotate",[30,0,["suggestChanges"]],"discourse_ai.ai_helper.context_menu.regen"]],null],[1,"\\n"]],[]]],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[l.default,d.default,a.default,n.htmlSafe,r.default,p.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/helpers/i18n","discourse-common/lib/get-url","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[o.service]))()
#S=(()=>{dt7948.i(this,"toasts")})()
static#i=(()=>dt7948.g(this.prototype,"shareKey",[s.tracked],(function(){return""})))()
#nt=(()=>{dt7948.i(this,"shareKey")})()
constructor(){super(...arguments),this.shareKey=this.args.model.share_key}get htmlContext(){let e=[]
return this.args.model.context.forEach((t=>{e.push(`<p><b>${t.username}:</b></p>`),e.push(t.cooked)})),(0,n.htmlSafe)(e.join("\n"))}async generateShareURL(){try{const e=await(0,l.ajax)("/discourse-ai/ai-bot/shared-ai-conversations",{type:"POST",data:{topic_id:this.args.model.topic_id}}),t=(0,p.getAbsoluteURL)(`/discourse-ai/ai-bot/shared-ai-conversations/${e.share_key}`)
return this.shareKey=e.share_key,new Blob([t],{type:"text/plain"})}catch(e){return void(0,c.popupAjaxError)(e)}}get primaryLabel(){return this.shareKey?"discourse_ai.ai_bot.share_full_topic_modal.update":"discourse_ai.ai_bot.share_full_topic_modal.share"}async deleteLink(){try{await(0,l.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/${this.shareKey}.json`,{type:"DELETE"}),this.shareKey=null}catch(e){(0,c.popupAjaxError)(e)}}static#n=(()=>dt7948.n(this.prototype,"deleteLink",[i.action]))()
async share(){await(0,u.clipboardCopyAsync)(this.generateShareURL.bind(this)),this.toasts.success({duration:3e3,data:{message:m.default.t("discourse_ai.ai_bot.conversation_shared")}})}static#r=(()=>dt7948.n(this.prototype,"share",[i.action]))()
static#l=(()=>(0,g.setComponentTemplate)((0,h.createTemplateFactory)({id:"A5MyH/Ft",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-full-topic-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_full_topic_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-full-topic-modal__body"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,2],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["share"]],[30,0,["primaryLabel"]]]],null],[1,"\\n"],[41,[30,0,["shareKey"]],[[[1,"          "],[8,[32,2],[[24,0,"btn-danger"]],[["@icon","@action","@label"],["far-trash-can",[30,0,["deleteLink"]],"discourse_ai.ai_bot.share_full_topic_modal.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal.js",scope:()=>[r.default,d.default,a.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse-common/helpers/i18n","discourse-common/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[a.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#r=(()=>dt7948.g(this.prototype,"contextValue",[s.tracked],(function(){return 1})))()
#at=(()=>{dt7948.i(this,"contextValue")})()
static#l=(()=>dt7948.g(this.prototype,"htmlContext",[s.tracked],(function(){return""})))()
#rt=(()=>{dt7948.i(this,"htmlContext")})()
static#c=(()=>dt7948.g(this.prototype,"maxContext",[s.tracked],(function(){return 0})))()
#lt=(()=>{dt7948.i(this,"maxContext")})()
static#u=(()=>dt7948.g(this.prototype,"allPosts",[s.tracked],(function(){return[]})))()
#ct=(()=>{dt7948.i(this,"allPosts")})()
static#d=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#it=(()=>{dt7948.i(this,"justCopiedText")})()
constructor(){super(...arguments)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let s=1;s<=this.args.model.post_number;s++)t.push(s)
this.allPosts=t.map((t=>{let s=e.findPostIdForPostNumber(t)
if(s)return e.findLoadedPost(s)})).filter((e=>e)),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const s=this.allPosts[t]
e.push(`<p><b>${s.username}:</b></p>`),e.push(s.cooked)}this.htmlContext=(0,r.htmlSafe)(e.join("\n"))}static#v=(()=>dt7948.n(this.prototype,"updateHtmlContext",[n.action]))()
async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,g.default)(this.args.model.topic,e,t),this.justCopiedText=p.default.t("discourse_ai.ai_bot.conversation_shared"),(0,d.default)((()=>{this.justCopiedText=""}),2e3)}static#w=(()=>dt7948.n(this.prototype,"copyContext",[n.action]))()
shareConversationModal(e){return e?.preventDefault(),this.args.closeModal(),(0,m.showShareConversationModal)(this.modal,this.args.model.topic_id),!1}static#x=(()=>dt7948.n(this.prototype,"shareConversationModal",[n.action]))()
static#R=(()=>(0,i.setComponentTemplate)((0,h.createTemplateFactory)({id:"Ccsc9yzh",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n          "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n          "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n            "],[1,[30,0,["contextValue"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n"],[41,[30,0,["currentUser","can_share_ai_bot_conversations"]],[[[1,"          "],[11,3],[24,6,""],[4,[32,3],["click",[30,0,["shareConversationModal"]]],null],[12],[1,"\\n            "],[10,1],[14,0,"ai-share-modal__share-tip"],[12],[1,"\\n              "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.share_tip"],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[c.default,u.default,i.Input,o.on,l.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#i=(()=>dt7948.g(this.prototype,"selectedImages",[s.tracked],(function(){return[]})))()
#ut=(()=>{dt7948.i(this,"selectedImages")})()
static#n=(()=>dt7948.g(this.prototype,"thumbnails",[s.tracked],(function(){return null})))()
#dt=(()=>{dt7948.i(this,"thumbnails")})()
constructor(){super(...arguments),this.findThumbnails()}get isDisabled(){return 0===this.selectedImages.length}async findThumbnails(){this.loading=!0
try{const e=await(0,l.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.args.model.mode,text:this.args.model.selectedText,force_default_locale:!0}})
this.thumbnails=e.thumbnails}catch(e){(0,c.popupAjaxError)(e)}finally{this.loading=!1}}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}static#r=(()=>dt7948.n(this.prototype,"addSelection",[i.action]))()
removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter((e=>{if(e!==t)return e}))}static#l=(()=>dt7948.n(this.prototype,"removeSelection",[i.action]))()
appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}static#c=(()=>dt7948.n(this.prototype,"appendSelectedImages",[i.action]))()
static#u=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"NK1Pg0q5",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[8,[32,2],null,[["@condition"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["thumbnails"]]],null]],null],null,[[[1,"              "],[8,[32,3],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,2],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[2]],null],[1,"          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","thumbnail"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[a.default,u.default,o.default,d.default,n.default,r.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"r8usWg+W",block:'[[[41,[30,1],[[[1,"  "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[37,2],[[30,1]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],false,["if","each","-each-in","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/model-accuracies.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)(void 0,"model-accuracies"))})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button",["exports","@glimmer/component","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static async cancelStreaming(e){try{await(0,o.ajax)(`/discourse-ai/ai-bot/post/${e.id}/stop-streaming`,{type:"POST"}),document.querySelector(`#post_${e.post_number}`).classList.remove("streaming")}catch(t){(0,n.popupAjaxError)(t)}}cancelStreaming(){this.constructor.cancelStreaming(this.args.post)}static#e=(()=>dt7948.n(this.prototype,"cancelStreaming",[s.action]))()
static#i=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"eS4Xq4iv",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__ai-cancel-streaming cancel-streaming"],[17,1]],[["@action","@icon","@title"],[[30,0,["cancelStreaming"]],"pause","discourse_ai.ai_bot.cancel_streaming"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static debugAiResponse(e,t){t.show(a.default,{model:e})}static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
debugAiResponse(){this.constructor.debugAiResponse(this.args.post,this.modal)}static#i=(()=>dt7948.n(this.prototype,"debugAiResponse",[s.action]))()
static#n=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"a7gp58E/",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__debug-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["debugAiResponse"]],"info","discourse_ai.ai_bot.debug_ai"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static async shareAiResponse(e,t,s){e.post_number<=4?(await(0,a.default)(e.topic,1,e.post_number),s("discourse_ai.ai_bot.conversation_shared")):t.show(r.default,{model:e})}static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
shareAiResponse(){this.constructor.shareAiResponse(this.args.post,this.modal,this.args.showFeedback)}static#i=(()=>dt7948.n(this.prototype,"shareAiResponse",[s.action]))()
static#n=(()=>(0,l.setComponentTemplate)((0,c.createTemplateFactory)({id:"GGDSzGUM",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__share-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["shareAiResponse"]],"far-copy","discourse_ai.ai_bot.share"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/components/rag-options",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","discourse/components/d-tooltip","discourse-i18n","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"showIndexingOptions",[s.tracked],(function(){return!1})))()
#pt=(()=>{dt7948.i(this,"showIndexingOptions")})()
toggleIndexingOptions(e){this.showIndexingOptions=!this.showIndexingOptions,e.preventDefault(),e.stopPropagation()}static#i=(()=>dt7948.n(this.prototype,"toggleIndexingOptions",[n.action]))()
get indexingOptionsText(){return this.showIndexingOptions?r.default.t("discourse_ai.rag.options.hide_indexing_options"):r.default.t("discourse_ai.rag.options.show_indexing_options")}static#n=(()=>(0,i.setComponentTemplate)((0,l.createTemplateFactory)({id:"f2OHyYF7",block:'[[[1,"\\n"],[41,[30,1,["rag_uploads"]],[[[1,"      "],[11,3],[24,6,"#"],[24,0,"rag-options__indexing-options"],[4,[32,0],["click",[30,0,["toggleIndexingOptions"]]],null],[12],[1,[30,0,["indexingOptionsText"]]],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showIndexingOptions"]],[[[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.rag.options.rag_chunk_tokens"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,"step","any"],[24,"lang","en"],[24,0,"rag-options__rag_chunk_tokens"]],[["@type","@value"],["number",[30,1,["rag_chunk_tokens"]]]],null],[1,"\\n        "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1,["t"]],["discourse_ai.rag.options.rag_chunk_tokens_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,1,["t"]],["discourse_ai.rag.options.rag_chunk_overlap_tokens"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,"step","any"],[24,"lang","en"],[24,0,"rag-options__rag_chunk_overlap_tokens"]],[["@type","@value"],["number",[30,1,["rag_chunk_overlap_tokens"]]]],null],[1,"\\n        "],[8,[32,3],null,[["@icon","@content"],["circle-question",[28,[32,1,["t"]],["discourse_ai.rag.options.rag_chunk_overlap_tokens_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n      "],[18,2,null],[1,"\\n"]],[]],null],[1,"  "]],["@model","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-options.js",scope:()=>[o.on,r.default,i.Input,a.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/rag-upload-progress",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse-common/helpers/d-icon","discourse-common/utils/decorators","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static#e=(()=>dt7948.g(this.prototype,"messageBus",[n.service]))()
#ce=(()=>{dt7948.i(this,"messageBus")})()
static#i=(()=>dt7948.g(this.prototype,"updatedProgress",[s.tracked],(function(){return null})))()
#mt=(()=>{dt7948.i(this,"updatedProgress")})()
willDestroy(){super.willDestroy(...arguments),this.messageBus.unsubscribe(`/discourse-ai/rag/${this.args.upload.id}`)}trackProgress(){this.messageBus.subscribe(`/discourse-ai/rag/${this.args.upload.id}`,this.onIndexingUpdate)}static#n=(()=>dt7948.n(this.prototype,"trackProgress",[i.action]))()
onIndexingUpdate(e){(!this.updatedProgress||0===this.updatedProgress.left||this.updatedProgress.left>e.left||e.total===e.indexed)&&(this.updatedProgress=e)}static#r=(()=>dt7948.n(this.prototype,"onIndexingUpdate",[r.bind]))()
get calculateProgress(){return 0===this.progress.total?0:Math.ceil(100*this.progress.indexed/this.progress.total)}get fullyIndexed(){return this.progress&&0!==this.progress.total&&0===this.progress.left}get progress(){return this.updatedProgress?this.updatedProgress:this.args.ragIndexingStatuses?this.args.ragIndexingStatuses[this.args.upload.id]:[]}static#l=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"uaXfIUIG",block:'[[[1,"\\n    "],[11,"td"],[24,0,"rag-uploader__upload-status"],[4,[32,0],[[30,0,["trackProgress"]]],null],[12],[1,"\\n"],[41,[30,0,["progress"]],[[[41,[30,0,["fullyIndexed"]],[[[1,"          "],[10,1],[14,0,"indexed"],[12],[1,"\\n            "],[1,[28,[32,1],["check"],null]],[1,"\\n            "],[1,[28,[32,2,["t"]],["discourse_ai.rag.uploads.indexed"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,1],[14,0,"indexing"],[12],[1,"\\n            "],[1,[28,[32,1],["robot"],null]],[1,"\\n            "],[1,[28,[32,2,["t"]],["discourse_ai.rag.uploads.indexing"],null]],[1,"\\n            "],[1,[30,0,["calculateProgress"]]],[1,"%\\n          "],[13],[1,"\\n"]],[]]]],[]],[[[1,"        "],[10,1],[14,0,"uploaded"],[12],[1,[28,[32,2,["t"]],["discourse_ai.rag.uploads.uploaded"],null]],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-upload-progress.js",scope:()=>[o.default,a.default,l.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/rag-uploader",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/uppy/uppy-upload","discourse-common/helpers/d-icon","discourse-common/lib/debounce","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/rag-upload-progress","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends s.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[l.service]))()
#gt=(()=>{dt7948.i(this,"appEvents")})()
static#i=(()=>dt7948.g(this.prototype,"term",[t.tracked],(function(){return null})))()
#ht=(()=>{dt7948.i(this,"term")})()
static#n=(()=>dt7948.g(this.prototype,"filteredUploads",[t.tracked],(function(){return null})))()
#_t=(()=>{dt7948.i(this,"filteredUploads")})()
static#r=(()=>dt7948.g(this.prototype,"ragIndexingStatuses",[t.tracked],(function(){return null})))()
#V=(()=>{dt7948.i(this,"ragIndexingStatuses")})()
static#l=(()=>dt7948.g(this.prototype,"ragUploads",[t.tracked],(function(){return null})))()
#ft=(()=>{dt7948.i(this,"ragUploads")})()
uppyUpload=(()=>new d.default((0,a.getOwner)(this),{id:"discourse-ai-rag-uploader",maxFiles:20,type:"discourse_ai_rag_upload",uploadUrl:"/admin/plugins/discourse-ai/rag-document-fragments/files/upload",preventDirectS3Uploads:!0,uploadDone:e=>{const t=e.upload
t.status="uploaded",t.statusText=g.default.t("discourse_ai.rag.uploads.uploaded"),this.ragUploads.pushObject(t),this.debouncedSearch()}}))()
willDestroy(){super.willDestroy(...arguments),this.appEvents.off(`upload-mixin:${this.uppyUpload.config}:all-uploads-complete`,this,"_updateTargetWithUploads")}didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.uppyUpload.inProgressUploads?.length>0&&this.uppyUpload.cancelAllUploads(),this.ragUploads=this.target?.rag_uploads||[],this.filteredUploads=this.ragUploads
const e=this.target?.constructor?.name
this.ragUploads?.length&&this.target?.id&&(0,u.ajax)(`/admin/plugins/discourse-ai/rag-document-fragments/files/status.json?target_type=${e}&target_id=${this.target.id}`).then((e=>{this.set("ragIndexingStatuses",e)})),this.appEvents.on(`upload-mixin:${this.uppyUpload.config.id}:all-uploads-complete`,this,"_updateTargetWithUploads")}_updateTargetWithUploads(){this.updateUploads(this.ragUploads)}submitFiles(){this.uppyUpload.openPicker()}static#c=(()=>dt7948.n(this.prototype,"submitFiles",[n.action]))()
cancelUploading(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static#u=(()=>dt7948.n(this.prototype,"cancelUploading",[n.action]))()
search(){this.term?this.filteredUploads=this.ragUploads.filter((e=>e.original_filename.toUpperCase().indexOf(this.term.toUpperCase())>-1)):this.filteredUploads=this.ragUploads}static#d=(()=>dt7948.n(this.prototype,"search",[n.action]))()
debouncedSearch(){(0,m.default)(this,this.search,100)}static#v=(()=>dt7948.n(this.prototype,"debouncedSearch",[n.action]))()
removeUpload(e){this.ragUploads.removeObject(e),this.onRemove(e),this.debouncedSearch()}static#w=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
static#x=(()=>(0,s.setComponentTemplate)((0,_.createTemplateFactory)({id:"UWbFo3oO",block:'[[[1,"\\n    "],[10,0],[14,0,"rag-uploader"],[12],[1,"\\n      "],[10,"h3"],[12],[1,[28,[32,0,["t"]],["discourse_ai.rag.uploads.title"],null]],[13],[1,"\\n      "],[10,2],[12],[1,[28,[32,0,["t"]],["discourse_ai.rag.uploads.description"],null]],[13],[1,"\\n\\n"],[41,[30,0,["ragUploads"]],[[[1,"        "],[10,0],[14,0,"rag-uploader__search-input-container"],[12],[1,"\\n          "],[10,0],[14,0,"rag-uploader__search-input"],[12],[1,"\\n            "],[1,[28,[32,1],["search"],[["class"],["rag-uploader__search-input__search-icon"]]]],[1,"\\n            "],[8,[32,2],[[24,0,"rag-uploader__search-input__input"],[16,"placeholder",[28,[32,0,["t"]],["discourse_ai.rag.uploads.filter"],null]],[4,[32,3],["keyup",[30,0,["debouncedSearch"]]],null]],[["@value"],[[30,0,["term"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,"table"],[14,0,"rag-uploader__uploads-list"],[12],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["filteredUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[1,"\\n                "],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,1,["original_filename"]]],[1,"\\n              "],[13],[1,"\\n              "],[8,[32,4],null,[["@upload","@ragIndexingStatuses"],[[30,1],[30,0,["ragIndexingStatuses"]]]],null],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["removeUpload"]],[30,1]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["uppyUpload","inProgressUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,2,["original_filename"]]],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__upload-status"],[12],[1,"\\n                "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n                "],[10,1],[12],[1,[28,[32,0,["t"]],["discourse_ai.rag.uploads.uploading"],null]],[1,"\\n                  "],[1,[30,2,["uploadProgress"]]],[1,"%"],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["cancelUploading"]],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[2]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[11,"input"],[24,0,"hidden-upload-field"],[16,"disabled",[30,0,["uploading"]]],[24,"multiple","multiple"],[24,"accept",".txt,.md"],[24,4,"file"],[4,[32,7],[[30,0,["uppyUpload","setup"]]],null],[12],[13],[1,"\\n      "],[8,[32,5],[[24,0,"btn-default"]],[["@label","@icon","@title","@action"],["discourse_ai.rag.uploads.button","plus","discourse_ai.rag.uploads.button",[30,0,["submitFiles"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-uploader.js",scope:()=>[g.default,p.default,s.Input,o.on,h.default,c.default,i.fn,r.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@ember/component","@glimmer/component","discourse/plugins/chat/discourse/models/chat-channel","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,o.createTemplateFactory)({id:"yKOx21Wk",block:'[[[41,[30,0,["chatChannel"]],[[[1,"  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[39,1],null,[["@route","@models"],["chat.channel.near-message",[28,[37,2],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n      "],[8,[39,3],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,4],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,5],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n      "],[1,[28,[35,6],[[28,[37,7],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,9],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["if","link-to","array","chat-channel-title","reviewable-created-by","reviewable-post-header","html-safe","or","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.hbs",isStrictMode:!1})
class a extends s.default{get chatChannel(){if(this.args.reviewable.chat_channel)return i.default.create(this.args.reviewable.chat_channel)}}e.default=a,(0,t.setComponentTemplate)(n,a)})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"XJ3JIp4P",block:'[[[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n  "],[8,[39,0],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n  "],[8,[39,1],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,2],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,3],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"        "],[10,2],[12],[1,[28,[35,5],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,6],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,8],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["reviewable-topic-link","reviewable-post-edits","reviewable-created-by","reviewable-post-header","if","i18n","html-safe","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)(void 0,"reviewable-ai-post"))})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#n=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#Te=(()=>{dt7948.i(this,"suggestions")})()
static#r=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#bt=(()=>{dt7948.i(this,"untriggers")})()
static#l=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#yt=(()=>{dt7948.i(this,"triggerIcon")})()
static#c=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#Ue=(()=>{dt7948.i(this,"content")})()
static#u=(()=>dt7948.g(this.prototype,"topicContent",[s.tracked],(function(){return null})))()
#vt=(()=>{dt7948.i(this,"topicContent")})()
constructor(){super(...arguments),this.topicContent||void 0!==this.args.composer?.reply||this.fetchTopicContent()}async fetchTopicContent(){await(0,u.ajax)(`/t/${this.args.buffered.content.id}.json`).then((e=>{let{post_stream:t}=e
this.topicContent=t.posts[0].cooked}))}get showSuggestionButton(){const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply||this.topicContent
const t=this.content?.length>g.MIN_CHARACTER_COUNT
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}async loadSuggestions(){if(this.suggestions&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
try{const{assistant:e}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_category",{method:"POST",data:{text:this.content}})
this.suggestions=e}catch(e){(0,d.popupAjaxError)(e)}finally{this.loading=!1,this.triggerIcon="sync-alt"}return this.suggestions}static#d=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e){const t=this.args.composer,s=this.args.buffered
return t&&(t.set("categoryId",e.id),t.get("categoryId")),s&&this.args.buffered.set("category_id",e.id),this.dMenu.close()}static#v=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#w=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.triggerIcon="discourse-sparkles"}static#x=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#R=(()=>(0,h.setComponentTemplate)((0,_.createTemplateFactory)({id:"ckFiQc91",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-category-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-category-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"category-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[10,0],[14,0,"category-status"],[12],[1,"\\n                      "],[1,[28,[32,6],[[30,2]],null]],[1,"\\n                      "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                        "],[1,[30,2,["topicCount"]]],[13],[1,"\\n                    "],[13],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester.js",scope:()=>[m.default,p.default,o.on,l.default,r.default,i.fn,c.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/discourse-tag","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"toasts",[a.service]))()
#S=(()=>{dt7948.i(this,"toasts")})()
static#n=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#r=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#Te=(()=>{dt7948.i(this,"suggestions")})()
static#l=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#bt=(()=>{dt7948.i(this,"untriggers")})()
static#c=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#yt=(()=>{dt7948.i(this,"triggerIcon")})()
static#u=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#Ue=(()=>{dt7948.i(this,"content")})()
static#d=(()=>dt7948.g(this.prototype,"topicContent",[s.tracked],(function(){return null})))()
#vt=(()=>{dt7948.i(this,"topicContent")})()
constructor(){super(...arguments),this.topicContent||void 0!==this.args.composer?.reply||this.fetchTopicContent()}async fetchTopicContent(){await(0,u.ajax)(`/t/${this.args.buffered.content.id}.json`).then((e=>{let{post_stream:t}=e
this.topicContent=t.posts[0].cooked}))}get showSuggestionButton(){const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply||this.topicContent
const t=this.content?.length>g.MIN_CHARACTER_COUNT
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}get showDropdown(){return this.suggestions?.length<=0&&this.dMenu.close(),!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions&&this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
try{const{assistant:e}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_tags",{method:"POST",data:{text:this.content}})
this.suggestions=e
const t=this.args.composer?this.args.composer:this.args.buffered
if(this.#wt()&&(this.suggestions=this.suggestions.filter((e=>!t.get("tags").includes(e.name)))),this.suggestions?.length<=0)return void this.toasts.error({class:"ai-suggestion-error",duration:3e3,data:{message:(0,p.default)("discourse_ai.ai_helper.suggest_errors.no_suggestions")}})}catch(e){(0,d.popupAjaxError)(e)}finally{this.loading=!1,this.triggerIcon="sync-alt"}return this.suggestions}static#v=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
#wt(){const e=this.args.composer?this.args.composer:this.args.buffered
return e.get("tags")&&e.get("tags").length>0}#xt(e){return this.suggestions=this.suggestions.filter((t=>t.id!==e.id))}applySuggestion(e){const t=this.siteSettings.max_tags_per_topic,s=this.args.composer?this.args.composer:this.args.buffered
if(!s)return
const i=s.get("tags")
return i?i?.length>=t?this.toasts.error({class:"ai-suggestion-error",duration:3e3,data:{message:(0,p.default)("discourse_ai.ai_helper.suggest_errors.too_many_tags",{count:t})}}):(i.push(e.name),s.set("tags",[...i]),e.disabled=!0,void this.#xt(e)):(s.set("tags",[e.name]),void this.#xt(e))}static#w=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#x=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static#R=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#E=(()=>(0,h.setComponentTemplate)((0,_.createTemplateFactory)({id:"8IJI8bF5",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-tag-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-tags-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"tag-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@translatedLabel","@disabled","@action"],[[30,2,["name"]],[28,[30,0,["isDisabled"]],[[30,2]],null],[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[28,[32,6],[[30,2,["name"]]],[["count","noHref"],[[30,2,["count"]],true]]]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester.js",scope:()=>[m.default,p.default,o.on,l.default,r.default,i.fn,c.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/dropdown-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/helpers/i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#i=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#Te=(()=>{dt7948.i(this,"suggestions")})()
static#n=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#bt=(()=>{dt7948.i(this,"untriggers")})()
static#r=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#yt=(()=>{dt7948.i(this,"triggerIcon")})()
static#l=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#Ue=(()=>{dt7948.i(this,"content")})()
static#c=(()=>dt7948.g(this.prototype,"topicContent",[s.tracked],(function(){return null})))()
#vt=(()=>{dt7948.i(this,"topicContent")})()
constructor(){super(...arguments),this.topicContent||void 0!==this.args.composer?.reply||this.fetchTopicContent()}async fetchTopicContent(){await(0,l.ajax)(`/t/${this.args.buffered.content.id}.json`).then((e=>{let{post_stream:t}=e
this.topicContent=t.posts[0].cooked}))}get showSuggestionButton(){const e=document.querySelector(".composer-fields"),t=document.querySelector(".edit-topic-title")
this.content=this.args.composer?.reply||this.topicContent
const s=this.content?.length>p.MIN_CHARACTER_COUNT
return e&&(s?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),t&&(s?t.classList.add("showing-ai-suggestions"):t.classList.remove("showing-ai-suggestions")),s}async loadSuggestions(){if(this.suggestions&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
try{const{suggestions:e}=await(0,l.ajax)("/discourse-ai/ai-helper/suggest_title",{method:"POST",data:{text:this.content}})
this.suggestions=e}catch(e){(0,c.popupAjaxError)(e)}finally{this.loading=!1,this.triggerIcon="sync-alt"}return this.suggestions}static#u=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e){const t=this.args.composer?this.args.composer:this.args.buffered
t&&(t.set("title",e),this.dMenu.close())}static#d=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#v=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.triggerIcon="discourse-sparkles"}static#w=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#x=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"+B/3+brg",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-title-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-titles-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[16,"data-name",[30,2]],[16,"data-value",[30,3]],[16,"title",[30,2]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[30,2]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester.js",scope:()=>[d.default,u.default,o.on,r.default,a.default,i.fn],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"selected",[s.tracked],(function(){return!1})))()
#kt=(()=>{dt7948.i(this,"selected")})()
static#i=(()=>dt7948.g(this.prototype,"selectIcon",[s.tracked],(function(){return"far-circle"})))()
#St=(()=>{dt7948.i(this,"selectIcon")})()
static#n=(()=>dt7948.g(this.prototype,"selectLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"})))()
#Tt=(()=>{dt7948.i(this,"selectLabel")})()
toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="check-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}static#r=(()=>dt7948.n(this.prototype,"toggleSelection",[o.action]))()
static#l=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"BsBgpDKw",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n      "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n      "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@thumbnail"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[n.default,i.fn],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"aCrw9598",block:'[[[1,"\\n    "],[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[s.LinkTo,i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"KC2fBykS",block:'[[[1,"\\n    "],[8,[32,0],null,[["@composer"],[[30,1,["composer"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"kGrC+f/O",block:'[[[1,"\\n    "],[8,[32,0],null,[["@composer"],[[30,1,["composer"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"/0ln7rS4",block:'[[[1,"\\n    "],[8,[32,0],null,[["@composer"],[[30,1,["composer"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a}))
define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse-i18n"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===o.default.t("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}static#n=(()=>dt7948.n(this.prototype,"aiBotClasses",[(0,s.computed)("composerModel.targetRecipients","composerModel.title")]))()
get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.any((t=>e.any((e=>e===t.username))))}return!1}static#r=(()=>dt7948.n(this.prototype,"isAiBotChat",[(0,s.computed)("composerModel.targetRecipients")]))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"+zzrKPCx",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n    "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[s.default,t.default],isStrictMode:!0}),(0,n.default)(void 0,"search-result-decoration:SearchResultDecoration"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"topicThumbnails",[s.service]))()
#Mt=(()=>{dt7948.i(this,"topicThumbnails")})()
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static#i=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"QZDHnQQB",block:'[[[1,"\\n    "],[8,[32,0],null,null,null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[s.service]))()
#jt=(()=>{dt7948.i(this,"imageCaptionPopup")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/15Zu2iM",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showAutoCaptionLoader"]],[[[1,"      "],[10,0],[14,0,"auto-image-caption-loader"],[12],[1,"\\n        "],[1,[28,[32,0],null,[["size"],["small"]]]],[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.ai_helper.image_caption.automatic_caption_loading"],null]],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/runloop","@ember/service","discourse/lib/key-value-store","select-kit/components/dropdown-select-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e,t){return t?.currentUser?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const s=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.filter((e=>e.username)).any((e=>s.any((t=>t===e.username))))}return!1}(e.model,t.currentUser)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[n.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"llm",[s.tracked]))()
#Pt=(()=>{dt7948.i(this,"llm")})()
static#r=(()=>dt7948.g(this.prototype,"allowLLMSelector",[s.tracked],(function(){return!0})))()
#Ct=(()=>{dt7948.i(this,"allowLLMSelector")})()
STORE_NAMESPACE="discourse_ai_persona_selector_"
LLM_STORE_NAMESPACE="discourse_ai_llm_selector_"
preferredPersonaStore=(()=>new a.default(this.STORE_NAMESPACE))()
preferredLlmStore=(()=>new a.default(this.LLM_STORE_NAMESPACE))()
constructor(){if(super(...arguments),this.botOptions&&this.botOptions.length&&this.composer){let e=this.preferredPersonaStore.getObject("id")
if(this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.any((t=>t.id===e))&&(this._value=e)),this.composer.metaData={ai_persona_id:this._value},this.setAllowLLMSelector(),this.hasLlmSelector){let e=this.preferredLlmStore.getObject("id")
const t=this.llmOptions.find((t=>t.id===e))||this.llmOptions[0]
e=t?t.id:"",e&&(0,o.next)((()=>{this.currentLlm=e}))}(0,o.next)((()=>{this.resetTargetRecipients()}))}}get composer(){return this.args?.outletArgs?.model}get hasLlmSelector(){return this.currentUser.ai_enabled_chat_bots.any((e=>!e.is_persona))}get botOptions(){if(this.currentUser.ai_enabled_personas){let e=this.currentUser.ai_enabled_personas
return this.hasLlmSelector||(e=e.filter((e=>e.username))),e.map((e=>({id:e.id,name:e.name,description:e.description})))}}get filterable(){return this.botOptions.length>4}get value(){return this._value}set value(e){this._value=e,this.preferredPersonaStore.setObject({key:"id",value:e}),this.composer.metaData={ai_persona_id:e},this.setAllowLLMSelector(),this.resetTargetRecipients()}setAllowLLMSelector(){if(!this.hasLlmSelector)return void(this.allowLLMSelector=!1)
const e=this.currentUser.ai_enabled_personas.find((e=>e.id===this._value))
this.allowLLMSelector=!e?.force_default_llm}get currentLlm(){return this.llm}set currentLlm(e){this.llm=e,this.preferredLlmStore.setObject({key:"id",value:e}),this.resetTargetRecipients()}resetTargetRecipients(){if(this.allowLLMSelector){const e=this.currentUser.ai_enabled_chat_bots.find((e=>e.model_name===this.llm)).username
this.composer.set("targetRecipients",e)}else{const e=this.currentUser.ai_enabled_personas.find((e=>e.id===this._value))
this.composer.set("targetRecipients",e.username||"")}}get llmOptions(){return this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persona)).filter(Boolean).map((e=>({id:e.model_name,name:e.display_name})))}static#l=(()=>(0,l.setComponentTemplate)((0,c.createTemplateFactory)({id:"3PhHsEc5",block:'[[[1,"\\n    "],[10,0],[14,0,"persona-llm-selector"],[12],[1,"\\n      "],[10,0],[14,0,"gpt-persona"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"persona-llm-selector__persona-dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,1],null,[["icon","filterable"],["robot",[30,0,["filterable"]]]]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["allowLLMSelector"]],[[[1,"        "],[10,0],[14,0,"llm-selector"],[12],[1,"\\n          "],[8,[32,0],[[24,0,"persona-llm-selector__llm-dropdown"]],[["@value","@content","@options"],[[30,0,["currentLlm"]],[30,0,["llmOptions"]],[28,[32,1],null,[["icon"],["globe"]]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector.js",scope:()=>[r.default,i.hash],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"pUU9xiYM",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered"],[[30,1,["buffered"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"1tfDigvi",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered"],[[30,1,["buffered"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"IVWdzZFY",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered"],[[30,1,["buffered"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/modifiers/auto-focus","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[r.service]))()
#jt=(()=>{dt7948.i(this,"imageCaptionPopup")})()
updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}static#i=(()=>dt7948.n(this.prototype,"updateCaption",[i.action]))()
saveCaption(){this.imageCaptionPopup.updateCaption(),this.hidePopup()}static#n=(()=>dt7948.n(this.prototype,"saveCaption",[i.action]))()
resizeTextarea(e){const t=window.getComputedStyle(e),s=parseInt(t.borderTopWidth,10),i=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+s+i}px`}static#r=(()=>dt7948.n(this.prototype,"resizeTextarea",[i.action]))()
hidePopup(){this.imageCaptionPopup.showPopup=!1,this.imageCaptionPopup._request&&(this.imageCaptionPopup._request.abort(),this.imageCaptionPopup._request=null,this.imageCaptionPopup.toggleLoadingState(!1))}static#l=(()=>dt7948.n(this.prototype,"hidePopup",[i.action]))()
static#c=(()=>(0,g.setComponentTemplate)((0,h.createTemplateFactory)({id:"84lcZtW4",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"      "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n        "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[10,0],[14,0,"actions"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n          "],[8,[32,7],[[24,0,"btn-flat cancel-request"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n          "],[10,1],[14,0,"credits"],[12],[1,"\\n            "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n            "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[a.default,l.default,u.default,o.default,n.default,s.on,d.default,c.default,p.default,m.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[o.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
static#i=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#n=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#ge=(()=>{dt7948.i(this,"suggestion")})()
static#r=(()=>dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],(function(){return null})))()
#At=(()=>{dt7948.i(this,"_activeAIRequest")})()
get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find((e=>"proofread"===e.name))}suggest(){return this.loading=!0,this._activeAIRequest=(0,a.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.id,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then((e=>{let{suggestions:t}=e
this.suggestion=t[0].trim(),this.args.outletArgs.updateValue(this.suggestion)})).catch(r.popupAjaxError).finally((()=>{this.loading=!1})),this._activeAIRequest}static#l=(()=>dt7948.n(this.prototype,"suggest",[i.action]))()
static#c=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"9jHc25oQ",block:'[[[1,"\\n"],[41,[51,[30,1,["newValue"]]],[[[1,"      "],[8,[32,0],[[24,0,"btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[n.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/lib/ajax","discourse/lib/plugin-api","discourse/lib/search","discourse-common/helpers/d-icon","I18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d,p,m,g,h,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_search_enabled}static#e=(()=>dt7948.g(this.prototype,"router",[a.service]))()
#T=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"appEvents",[a.service]))()
#gt=(()=>{dt7948.i(this,"appEvents")})()
static#n=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#r=(()=>dt7948.g(this.prototype,"searchPreferencesManager",[a.service]))()
#Ot=(()=>{dt7948.i(this,"searchPreferencesManager")})()
static#l=(()=>dt7948.g(this.prototype,"searching",[s.tracked],(function(){return!1})))()
#Rt=(()=>{dt7948.i(this,"searching")})()
static#c=(()=>dt7948.g(this.prototype,"AiResults",[s.tracked],(function(){return[]})))()
#Et=(()=>{dt7948.i(this,"AiResults")})()
static#u=(()=>dt7948.g(this.prototype,"showingAiResults",[s.tracked],(function(){return!1})))()
#Nt=(()=>{dt7948.i(this,"showingAiResults")})()
initialSearchTerm=this.args.outletArgs.search
get disableToggleSwitch(){if(this.searching||0===this.AiResults.length||0!==this.args.outletArgs.sortOrder)return!0}get searchStateText(){return this.AiResults.length>0?this.showingAiResults?m.default.t("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AiResults.length}):m.default.t("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AiResults.length}):this.searching?m.default.t("discourse_ai.embeddings.semantic_search_loading"):0===this.AiResults.length&&this.searchTerm!==this.initialSearchTerm?m.default.t("discourse_ai.embeddings.semantic_search_results.new"):0===this.AiResults.length?m.default.t("discourse_ai.embeddings.semantic_search_results.none"):void 0}get searchTerm(){return this.initialSearchTerm!==this.args.outletArgs.search&&(this.initialSearchTerm=void 0),this.args.outletArgs.search}get searchEnabled(){return this.args.outletArgs.type===l.SEARCH_TYPE_DEFAULT&&(0,d.isValidSearchTerm)(this.searchTerm,this.siteSettings)&&0===this.args.outletArgs.sortOrder}toggleAiResults(){this.showingAiResults?this.args.outletArgs.addSearchResults([],"topic_id"):this.args.outletArgs.addSearchResults(this.AiResults,"topic_id"),this.showingAiResults=!this.showingAiResults}static#d=(()=>dt7948.n(this.prototype,"toggleAiResults",[o.action]))()
resetAiResults(){this.AiResults=[],this.showingAiResults=!1,this.args.outletArgs.addSearchResults([],"topic_id")}static#v=(()=>dt7948.n(this.prototype,"resetAiResults",[o.action]))()
handleSearch(){if(this.searchEnabled)return this.initialSearchTerm&&!this.searching?this.performHyDESearch():void this.#Ut()}static#w=(()=>dt7948.n(this.prototype,"handleSearch",[o.action]))()
performHyDESearch(){this.searching=!0,this.resetAiResults(),(0,c.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then((async e=>{const t=await(0,d.translateResults)(e)||{}
0!==t.posts?.length?(t.posts.forEach((e=>{e.generatedByAi=!0})),this.AiResults=t.posts):this.searching=!1})).finally((()=>this.searching=!1))}#Ut(){return(0,u.withPluginApi)("1.15.0",(e=>{e.onAppEvent("full-page-search:trigger-search",(()=>{if(!this.searching)return this.resetAiResults(),this.performHyDESearch()}))}))}checkQueryParamsAndSearch(){const e=this.router.currentRoute?.queryParams?.q
e&&this.#Ut()}static#x=(()=>dt7948.n(this.prototype,"checkQueryParamsAndSearch",[o.action]))()
static#R=(()=>(0,h.setComponentTemplate)((0,_.createTemplateFactory)({id:"BYYsON7+",block:'[[[1,"\\n    "],[11,1],[4,[32,0],[[30,0,["checkQueryParamsAndSearch"]]],null],[12],[13],[1,"\\n"],[41,[30,0,["searchEnabled"]],[[[1,"      "],[10,0],[14,0,"semantic-search__container search-results"],[14,"role","region"],[12],[1,"\\n        "],[11,0],[24,0,"semantic-search__results"],[4,[32,0],[[30,0,["handleSearch"]]],null],[12],[1,"\\n          "],[10,0],[15,0,[29,["semantic-search__searching\\n              ",[52,[30,0,["searching"]],"in-progress"]]]],[12],[1,"\\n            "],[8,[32,1],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,0,"semantic-search__results-toggle"],[4,[32,2],["click",[30,0,["toggleAiResults"]]],null]],[["@state"],[[30,0,["showingAiResults"]]]],null],[1,"\\n\\n            "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n              "],[1,[28,[32,3],["discourse-sparkles"],null]],[1,"\\n              "],[1,[30,0,["searchStateText"]]],[1,"\\n            "],[13],[1,"\\n\\n            "],[8,[32,4],null,[["@loading"],[[30,0,["searching"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search.js",scope:()=>[n.default,r.default,i.on,p.default,g.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/virtual-element-from-text-range","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static shouldRender(e,t){return(0,c.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"site",[o.service]))()
#h=(()=>{dt7948.i(this,"site")})()
static#i=(()=>dt7948.g(this.prototype,"menu",[o.service]))()
#ue=(()=>{dt7948.i(this,"menu")})()
static#n=(()=>dt7948.g(this.prototype,"menuState",[s.tracked],(function(){return this.MENU_STATES.triggers})))()
#pe=(()=>{dt7948.i(this,"menuState")})()
static#r=(()=>dt7948.g(this.prototype,"showMainButtons",[s.tracked],(function(){return!0})))()
#Lt=(()=>{dt7948.i(this,"showMainButtons")})()
static#l=(()=>dt7948.g(this.prototype,"showAiButtons",[s.tracked],(function(){return!0})))()
#be=(()=>{dt7948.i(this,"showAiButtons")})()
static#c=(()=>dt7948.g(this.prototype,"originalPostHTML",[s.tracked],(function(){return null})))()
#Dt=(()=>{dt7948.i(this,"originalPostHTML")})()
static#u=(()=>dt7948.g(this.prototype,"postHighlighted",[s.tracked],(function(){return!1})))()
#It=(()=>{dt7948.i(this,"postHighlighted")})()
static#d=(()=>dt7948.g(this.prototype,"currentMenu",[s.tracked],(function(){return this.menu.getByIdentifier("post-text-selection-toolbar")})))()
#Ft=(()=>{dt7948.i(this,"currentMenu")})()
MENU_STATES={triggers:"TRIGGERS",options:"OPTIONS"}
willDestroy(){super.willDestroy(...arguments),this.removeHighlightedText()}highlightSelectedText(){const e=this.args.outletArgs.data.quoteState.postId,t=document.querySelector(`article[data-post-id='${e}'] .cooked`)
if(!t)return
this.originalPostHTML=t.innerHTML,this.selectedText=this.args.outletArgs.data.quoteState.buffer
const s=window.getSelection()
if(!s.rangeCount)return
const i=s.getRangeAt(0)
if(i.startContainer.nodeType===Node.TEXT_NODE&&i.startOffset>0){const e=i.startContainer.splitText(i.startOffset)
i.setStart(e,0)}i.endContainer.nodeType===Node.TEXT_NODE&&i.endOffset<i.endContainer.length&&i.endContainer.splitText(i.endOffset)
const o=document.createTreeWalker(i.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:e=>i.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),n=[]
if(o.currentNode?.nodeType===Node.TEXT_NODE)n.push(o.currentNode)
else for(;o.nextNode();)n.push(o.currentNode)
for(let a of n){const e=document.createElement("span")
e.classList.add("ai-helper-highlighted-selection")
const t=a.cloneNode(!0)
e.appendChild(t),a.parentNode.replaceChild(e,a)}s.removeAllRanges(),this.postHighlighted=!0}removeHighlightedText(){if(!this.postHighlighted)return
const e=this.args.outletArgs.data.quoteState.postId,t=document.querySelector(`article[data-post-id='${e}'] .cooked`)
t&&(t.innerHTML=this.originalPostHTML,this.postHighlighted=!1)}async showAiPostHelperMenu(){this.highlightSelectedText(),this.site.mobileView&&(this.currentMenu.close(),await this.menu.show((0,a.default)(),{identifier:"ai-post-helper-menu",component:l.default,inline:!0,interactive:!0,placement:this.shouldRenderUnder?"bottom-start":"top-start",fallbackPlacements:this.shouldRenderUnder?["bottom-end","top-start"]:["bottom-start"],trapTab:!1,closeOnScroll:!1,modalForMobile:!0,data:this.menuData})),this.showMainButtons=!1,this.menuState=this.MENU_STATES.options}static#v=(()=>dt7948.n(this.prototype,"showAiPostHelperMenu",[i.action]))()
get menuData(){return{...this.args.outletArgs.data,quoteState:{buffer:this.args.outletArgs.data.quoteState.buffer,opts:this.args.outletArgs.data.quoteState.opts,postId:this.args.outletArgs.data.quoteState.postId},post:this.args.outletArgs.post,selectedText:this.selectedText}}static#w=(()=>(0,u.setComponentTemplate)((0,d.createTemplateFactory)({id:"NUAbK/gN",block:'[[[1,"\\n"],[41,[30,0,["showMainButtons"]],[[[1,"      "],[18,1,null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","triggers"]]],null],[[[1,"          "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAiPostHelperMenu"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[8,[32,2],null,[["@data"],[[30,0,["menuData"]]]],null],[1,"\\n        "]],[]],null]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger.js",scope:()=>[r.default,n.default,l.default],isStrictMode:!0}),this))()}e.default=p})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"quickSearch",[s.service]))()
#qt=(()=>{dt7948.i(this,"quickSearch")})()
static#i=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"apo2cAJf",block:'[[[1,"\\n"],[41,[30,0,["quickSearch","loading"]],[[[1,"      "],[10,0],[14,0,"ai-quick-search-spinner"],[12],[1,"\\n        "],[1,[32,0]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/search-menu/results/assistant-item","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_quick_search_enabled}static#e=(()=>dt7948.g(this.prototype,"search",[i.service]))()
#Bt=(()=>{dt7948.i(this,"search")})()
static#i=(()=>dt7948.g(this.prototype,"quickSearch",[i.service]))()
#qt=(()=>{dt7948.i(this,"quickSearch")})()
static#n=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
async searchTermChanged(){if(this.search.activeGlobalSearchTerm){if(!(0,r.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings))return this.search.noResults=!0,this.search.results={},this.quickSearch.loading=!1,void(this.quickSearch.invalidTerm=!0)
await this.performSearch()}else this.search.noResults=!1,this.search.results={},this.quickSearch.loading=!1,this.quickSearch.invalidTerm=!1}static#r=(()=>dt7948.n(this.prototype,"searchTermChanged",[s.action]))()
async performSearch(){this.quickSearch.loading=!0,this.quickSearch.invalidTerm=!1
try{const e=await(0,n.ajax)("/discourse-ai/embeddings/quick-search",{data:{q:this.search.activeGlobalSearchTerm}}),t=await(0,r.translateResults)(e)
t&&(this.search.noResults=0===e.resultTypes.length,this.search.results=t)}catch(e){(0,a.popupAjaxError)(e)}finally{this.quickSearch.loading=!1}}static#l=(()=>(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"xqHDbd5x",block:'[[[1,"\\n    "],[18,3,null],[1,"\\n\\n"],[41,[30,0,["search","activeGlobalSearchTerm"]],[[[1,"      "],[8,[32,0],null,[["@suffix","@icon","@closeSearchMenu","@searchTermChanged","@suggestionKeyword"],[[28,[32,1],["discourse_ai.embeddings.quick_search.suffix"],null],"discourse-sparkles",[30,1],[30,0,["searchTermChanged"]],[30,2]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@closeSearchMenu","@suggestionKeyword","&default"],false,["yield","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search.js",scope:()=>[o.default,l.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info",["exports","@glimmer/component","@ember/service","discourse/lib/search","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"search",[s.service]))()
#Bt=(()=>{dt7948.i(this,"search")})()
static#i=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#n=(()=>dt7948.g(this.prototype,"quickSearch",[s.service]))()
#qt=(()=>{dt7948.i(this,"quickSearch")})()
get termTooShort(){return!(0,i.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.quickSearch.invalidTerm&&this.search.activeGlobalSearchTerm?.length>0}static#r=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"k6uzZwr4",block:'[[[1,"\\n"],[41,[30,0,["termTooShort"]],[[[1,"      "],[10,0],[14,0,"no-results"],[12],[1,[28,[32,0],["search.too_short"],null]],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"4O7HJkah",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"jo6+zYZR",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showPostAIHelper)(e,t)}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"obhR2Q8M",block:'[[[1,"\\n    "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-list-before-category/ai-topic-gist-placement",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-topic-gist","@ember/component","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){const s=t.siteSettings
return s.discourse_ai_enabled&&s.ai_summarization_enabled}static#e=(()=>(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"SgsKZfRi",block:'[[[1,"\\n    "],[8,[32,0],null,[["@topic"],[[30,1,["topic"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-list-before-category/ai-topic-gist-placement.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#g=(()=>{dt7948.i(this,"modal")})()
openAiSummaryModal(){this.modal.show(n.default,{model:{topic:this.args.outletArgs.topic,postStream:this.args.outletArgs.postStream}})}static#i=(()=>dt7948.n(this.prototype,"openAiSummaryModal",[s.action]))()
static#n=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"Spf4X9+Y",block:'[[[1,"\\n"],[41,[30,1,["topic","summarizable"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-summarization-button"]],[["@label","@icon","@action"],["summary.buttons.generate","discourse-sparkles",[30,0,["openAiSummaryModal"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences",["exports","@glimmer/component","@ember/routing","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t.siteSettings.discourse_ai_enabled&&function(e,t){const s=t.ai_helper_enabled_features.split("|")
return e?.user_allowed_ai_auto_image_captions&&s.includes("image_caption")&&t.ai_helper_enabled}(e.model,t.siteSettings)}static#e=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/y5E1bgJ",block:'[[[1,"\\n    "],[10,"li"],[14,0,"user-nav__preferences-ai"],[12],[1,"\\n      "],[8,[32,0],null,[["@route"],["preferences.ai"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,2],["discourse_ai.title"],null]],[13],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences.js",scope:()=>[s.LinkTo,i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/controllers/admin-dashboard-sentiment",["exports","@ember/object","admin/controllers/admin-dashboard-tab"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}static#e=(()=>dt7948.n(this.prototype,"filters",[(0,t.computed)("startDate","endDate")]))()
get emotionFilters(){return{startDate:moment().subtract(2,"month").format("YYYY-MM-DD"),endDate:moment().format("YYYY-MM-DD")}}get emotions(){return["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","neutral","optimism","pride","realization","relief","remorse","sadness","surprise"]}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/controllers/preferences-ai",["exports","@glimmer/tracking","@ember/controller","@ember/object","@ember/service","discourse/lib/ajax-error","discourse-common/config/environment"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=["auto_image_caption"]
class l extends s.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[o.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
static#i=(()=>dt7948.g(this.prototype,"saved",[t.tracked],(function(){return!1})))()
#zt=(()=>{dt7948.i(this,"saved")})()
get showAutoImageCaptionSetting(){const e=this.siteSettings.ai_helper_enabled_features.split("|")
return this.model?.user_allowed_ai_auto_image_captions&&e.includes("image_caption")&&this.siteSettings.ai_helper_enabled}save(){return this.saved=!1,this.model.save(r).then((()=>{this.saved=!0,(0,a.isTesting)()||location.reload()})).catch(n.popupAjaxError)}static#n=(()=>dt7948.n(this.prototype,"save",[i.action]))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/discourse-ai-shared-conversation-show-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-shared-conversation-show",{path:"/discourse-ai/ai-bot/shared-ai-conversations/:share_key"})}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/models/composer","I18n","discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.composeAiBotMessage=function(e,t){let s=t.currentUser.ai_enabled_chat_bots.find((t=>t.model_name===e)).username
t.focusComposer({fallbackToNewTopic:!0,openOpts:{action:i.default.PRIVATE_MESSAGE,recipients:s,topicTitle:o.default.t("discourse_ai.ai_bot.default_pm_prefix"),archetypeId:"private_message",draftKey:"private_message_ai",hasGroups:!1,warningsDisabled:!0,skipDraftCheck:!0}})},e.isPostFromAiBot=function(e,t){return e.user_id<=a||!!t?.ai_enabled_chat_bots?.any((t=>e.username===t.username))},e.showShareConversationModal=function(e,i){(0,t.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/preview/${i}.json`).then((t=>{e.show(n.default,{model:t})})).catch(s.popupAjaxError)}
const a=-1200})),define("discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_CHARACTER_COUNT=void 0
e.MIN_CHARACTER_COUNT=40})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers",["exports","@ember/runloop","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDot=function(e){let t=e
for(;;){let e=l(t)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
t=e}const s=document.createElement("span")
s.classList.add("progress-dot"),t.appendChild(s)},e.applyProgress=c,e.default=function(e,s,o){const n=new e(s,o)
r||(r=(0,t.later)((async()=>{await c(s,n),r=null,s.done||await c(s,n)}),i))},e.streamPostText=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,u(e)}
const i=40,o=6e4,n=e.MIN_LETTERS_PER_INTERVAL=6,a=800
let r=null
function l(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}async function c(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>o)return t.streaming=!1,!0
if(!t.element)return!1
const s=t.raw
if(e.raw===s&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let o=e.raw
if(!e.done)if(0===s.length&&-1!==o.indexOf("</details>"))o=e.raw
else{const t=o.length-s.length
let r=Math.floor(t/(a/i))
r<n&&(r=n),o=e.raw.substring(0,s.length+r)}await t.setRaw(o,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked),t.streaming=!1),e.done}function u(e){r||(r=(0,t.later)((async()=>{const t=await async function(e){const t=e.aiStreamingStatus
let i=!1
const o=Object.keys(t).map((async o=>{let n=t[o]
const a=new s.default(e,n.post_id)
await c(n,a)?delete t[o]:i=!0}))
return await Promise.all(o),i}(e)
r=null,t&&u(e)}),i))}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater",["exports","discourse/lib/load-morphlex","discourse/lib/text","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends o.default{morphingOptions={beforeAttributeUpdated:(e,t)=>!("DETAILS"===e.tagName&&"open"===t)}
constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t),this.post&&(this.postElement=document.querySelector(`#post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const o=await(0,s.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const n=document.createElement("div")
n.innerHTML=o,t||(0,i.addProgressDot)(n),await this.setCooked(n.innerHTML)}async setCooked(e){this.post.set("cooked",e),(await(0,t.default)()).morphInner(this.postElement.querySelector(".cooked"),`<div>${e}</div>`,this.morphingOptions)}get raw(){return this.post.get("raw")||""}}e.default=n})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-topic-summary",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/lib/formatter","discourse/lib/text"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n{static#e=(()=>dt7948.g(this.prototype,"text",[t.tracked],(function(){return""})))()
#Ve=(()=>{dt7948.i(this,"text")})()
static#i=(()=>dt7948.g(this.prototype,"summarizedOn",[t.tracked],(function(){return null})))()
#He=(()=>{dt7948.i(this,"summarizedOn")})()
static#n=(()=>dt7948.g(this.prototype,"summarizedBy",[t.tracked],(function(){return null})))()
#$e=(()=>{dt7948.i(this,"summarizedBy")})()
static#r=(()=>dt7948.g(this.prototype,"newPostsSinceSummary",[t.tracked],(function(){return null})))()
#Ye=(()=>{dt7948.i(this,"newPostsSinceSummary")})()
static#l=(()=>dt7948.g(this.prototype,"outdated",[t.tracked],(function(){return!1})))()
#Ge=(()=>{dt7948.i(this,"outdated")})()
static#c=(()=>dt7948.g(this.prototype,"canRegenerate",[t.tracked],(function(){return!1})))()
#Ke=(()=>{dt7948.i(this,"canRegenerate")})()
static#u=(()=>dt7948.g(this.prototype,"regenerated",[t.tracked],(function(){return!1})))()
#Vt=(()=>{dt7948.i(this,"regenerated")})()
static#d=(()=>dt7948.g(this.prototype,"showSummaryBox",[t.tracked],(function(){return!1})))()
#Ht=(()=>{dt7948.i(this,"showSummaryBox")})()
static#v=(()=>dt7948.g(this.prototype,"canCollapseSummary",[t.tracked],(function(){return!1})))()
#$t=(()=>{dt7948.i(this,"canCollapseSummary")})()
static#w=(()=>dt7948.g(this.prototype,"loadingSummary",[t.tracked],(function(){return!1})))()
#Yt=(()=>{dt7948.i(this,"loadingSummary")})()
processUpdate(e){const t=e.ai_topic_summary
return(0,o.cook)(t.summarized_text).then((e=>{this.text=e,this.loading=!1})).then((()=>{e.done&&(this.summarizedOn=(0,i.shortDateNoYear)(t.summarized_on),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.newPostsSinceSummary=t.new_posts_since_summary,this.canRegenerate=t.outdated&&t.can_regenerate)}))}collapse(){this.showSummaryBox=!1,this.canCollapseSummary=!1}generateSummary(e,t){if(this.showSummaryBox=!0,this.text&&!this.canRegenerate)return void(this.canCollapseSummary=!1)
let i=`/discourse-ai/summarization/t/${t}?`
return e&&(i+="stream=true",this.canRegenerate&&(i+="&skip_age_check=true")),this.loading=!0,(0,s.ajax)(i).then((t=>{e||(t.done=!0,this.processUpdate(t))}))}}e.default=n}))
define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,o,n){await(0,s.clipboardCopyAsync)((async()=>{const s=await async function(e,s,o){const n=e.get("postStream")
let a=[]
for(let t=s;t<=o;t++)a.push(t)
const r=a.map((e=>n.findPostIdForPostNumber(e))),l=`/t/${e.id}/posts.json`,c={post_ids:r,include_raw:!0},u=await(0,t.ajax)(l,{data:c})
let d=[]
d.push("<details class='ai-quote'>"),d.push("<summary>"),d.push(`<span>${e.title}</span>`),d.push(`<span title='${i.default.t("discourse_ai.ai_bot.ai_title")}'>${i.default.t("discourse_ai.ai_bot.ai_label")}</span>`),d.push("</summary>"),u.post_stream.posts.forEach((e=>{d.push(""),d.push(`**${e.username}:**`),d.push(""),d.push(e.raw)})),d.push("</details>")
const p=d.join("\n")
return p}(e,o,n)
return new Blob([s],{type:"text/plain"})}))}})),define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],(function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAiHelper=function(e,s,i,o){const n=t(s),a=i.can_use_assistant,r=s.ai_helper_allowed_in_pm,l=s.ai_helper_enabled_features.includes(o)
if(e?.privateMessage)return n&&a&&r&&l
return n&&a&&l},e.showPostAIHelper=function(e,s){return t(s.siteSettings)&&s.currentUser?.can_use_assistant_in_post}})),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports","@ember/template","discourse/lib/utilities"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.jsonToHtml=function e(i){if(null===i)return"null"
if("object"!=typeof i)return(0,s.escapeExpression)(i)
let o="<ul>"
for(let[t,n]of Object.entries(i))o+="<li>",t=(0,s.escapeExpression)(t),"object"==typeof n&&Array.isArray(n)?o+=`<strong>${t}:</strong> ${e(n)}`:"object"==typeof n?o+=`<strong>${t}:</strong> <ul><li>${e(n)}</li></ul>`:("string"==typeof n&&(n=(0,s.escapeExpression)(n).replace(/\n/g,"<br>")),o+=`<strong>${t}:</strong> ${n}`),o+="</li>"
return o+="</ul>",(0,t.htmlSafe)(o)}})),define("discourse/plugins/discourse-ai/discourse/lib/virtual-element-from-caret-coords",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,s){return new t(e,s)}
class t{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0]
this.caretCoords=e,this.offset=t,this.updateRect()}updateRect(){const[e,t]=this.offset
return this.rect={top:this.caretCoords.y+t,right:this.caretCoords.x,bottom:this.caretCoords.y+t,left:this.caretCoords.x+e,width:0,height:0,x:this.caretCoords.x,y:this.caretCoords.y,toJSON(){return this}},this.rect}getBoundingClientRect(){return this.rect}getClientRects(){return[this.rect]}get clientWidth(){return this.rect.width}get clientHeight(){return this.rect.height}}})),define("discourse/plugins/discourse-ai/discourse/preferences-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"user.preferences",map(){this.route("ai")}}})),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-shared-conversation-show",["exports","@ember/service","discourse/routes/discourse"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[t.service]))()
#p=(()=>{dt7948.i(this,"currentUser")})()
beforeModel(e){this.currentUser?.user_option?.external_links_in_new_tab?window.open(e.intent.url,"_blank"):this.redirect(e.intent.url),e.abort()}redirect(e){window.location=e}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/routes/preferences-ai",["exports","@ember/service","discourse/lib/utilities","discourse/routes/restricted-user"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[t.service]))()
#s=(()=>{dt7948.i(this,"siteSettings")})()
setupController(e,t){if(!this.siteSettings.discourse_ai_enabled)return this.router.transitionTo(`discovery.${(0,s.defaultHomepage)()}`)
e.set("model",t)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/gists",["exports","@glimmer/tracking","@ember/service"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"router",[s.service]))()
#T=(()=>{dt7948.i(this,"router")})()
static#i=(()=>dt7948.g(this.prototype,"preference",[t.tracked],(function(){return localStorage.getItem("topicListLayout")})))()
#Gt=(()=>{dt7948.i(this,"preference")})()
get shouldShow(){const e=this.router.currentRoute.name,t=e.includes("discovery"),s=!e.includes("categories"),i=this.router.currentRoute.attributes?.list?.topics?.some((e=>e.ai_topic_gist))
return t&&s&&i}setPreference(e){this.preference=e,localStorage.setItem("topicListLayout",e),"table-ai"===this.preference&&localStorage.setItem("aiPreferred",!0)}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service","discourse/lib/uploads"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{static#e=(()=>dt7948.g(this.prototype,"composer",[s.service]))()
#m=(()=>{dt7948.i(this,"composer")})()
static#i=(()=>dt7948.g(this.prototype,"appEvents",[s.service]))()
#gt=(()=>{dt7948.i(this,"appEvents")})()
static#n=(()=>dt7948.g(this.prototype,"showPopup",[t.tracked],(function(){return!1})))()
#Kt=(()=>{dt7948.i(this,"showPopup")})()
static#r=(()=>dt7948.g(this.prototype,"imageIndex",[t.tracked],(function(){return null})))()
#Wt=(()=>{dt7948.i(this,"imageIndex")})()
static#l=(()=>dt7948.g(this.prototype,"imageSrc",[t.tracked],(function(){return null})))()
#Qt=(()=>{dt7948.i(this,"imageSrc")})()
static#c=(()=>dt7948.g(this.prototype,"newCaption",[t.tracked],(function(){return null})))()
#Xt=(()=>{dt7948.i(this,"newCaption")})()
static#u=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#d=(()=>dt7948.g(this.prototype,"popupTrigger",[t.tracked],(function(){return null})))()
#Zt=(()=>{dt7948.i(this,"popupTrigger")})()
static#v=(()=>dt7948.g(this.prototype,"showAutoCaptionLoader",[t.tracked],(function(){return!1})))()
#Jt=(()=>{dt7948.i(this,"showAutoCaptionLoader")})()
static#w=(()=>dt7948.g(this.prototype,"_request",[t.tracked],(function(){return null})))()
#es=(()=>{dt7948.i(this,"_request")})()
updateCaption(){const e=this.composer.model.reply.match(i.IMAGE_MARKDOWN_REGEX)
if(e){const t=e[this.imageIndex],s=t.replace(i.IMAGE_MARKDOWN_REGEX,`![${this.newCaption}|$2$3$4]($5)`)
t&&this.appEvents.trigger("composer:replace-text",t,s)}}toggleLoadingState(e){return e?(this.popupTrigger?.classList.add("disabled"),this.loading=!0):(this.popupTrigger?.classList.remove("disabled"),this.loading=!1)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/quick-search",["exports","@glimmer/tracking","@ember/service"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#me=(()=>{dt7948.i(this,"loading")})()
static#i=(()=>dt7948.g(this.prototype,"invalidTerm",[t.tracked],(function(){return!1})))()
#ts=(()=>{dt7948.i(this,"invalidTerm")})()}e.default=i})),define("discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"xc25zq0U",block:'[[[10,0],[14,0,"sentiment section"],[12],[1,"\\n  "],[10,0],[14,0,"period-section"],[12],[1,"\\n    "],[10,0],[14,0,"section-title"],[12],[1,"\\n      "],[10,"h2"],[12],[1,"\\n        "],[1,[28,[35,0],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[39,1],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,0,["period"]],[30,0,["setPeriod"]],[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["setCustomDateRange"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"section-body"],[12],[1,"\\n    "],[10,0],[14,0,"charts"],[12],[1,"\\n      "],[8,[39,2],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,0,["filters"]],true]],null],[1,"\\n      "],[10,0],[14,0,"admin-report activity-metrics"],[12],[1,"\\n        "],[10,0],[14,0,"header"],[12],[1,"\\n          "],[10,"ul"],[14,0,"breadcrumb"],[12],[1,"\\n            "],[10,"li"],[14,0,"item report"],[12],[1,"\\n              "],[8,[39,3],[[24,0,"report-url"]],[["@route"],["adminReports"]],[["default"],[[[[1,"\\n                "],[1,[28,[35,0],["admin.dashboard.emotion.title"],null]],[1,"\\n              "]],[]]]]],[1,"\\n              "],[8,[39,4],null,[["@interactive"],["true"]],[["trigger","content"],[[[[1,"\\n                  "],[1,[28,[35,5],["circle-question"],null]],[1,"\\n                "]],[]],[[[1,"\\n                  "],[10,1],[12],[1,[28,[35,0],["admin.dashboard.emotion.description"],null]],[13],[1,"\\n                "]],[]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"report-body"],[12],[1,"\\n          "],[10,0],[14,0,"counters-list"],[12],[1,"\\n            "],[10,0],[14,0,"counters-header"],[12],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,0],["admin.dashboard.reports.today"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,0],["admin.dashboard.reports.yesterday"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,0],["admin.dashboard.reports.last_7_days"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,0],["admin.dashboard.reports.last_30_days"],null]],[13],[1,"\\n            "],[13],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["emotions"]]],null]],null],null,[[[1,"              "],[8,[39,2],null,[["@showHeader","@filters","@forcedModes","@dataSourceName"],[false,[30,0,["emotionFilters"]],"emotion",[29,["emotion_",[30,1]]]]],null],[1,"\\n"]],[1]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["metric"],false,["i18n","dashboard-period-selector","admin-report","link-to","d-tooltip","d-icon","each","-track-array"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"qd5dUHbD",block:'[[[41,[30,0,["isAiBotChat"]],[[[1,"  "],[1,[28,[35,1],[[30,0,["aiBotClasses"]]],null]],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"    "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[35,2],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null]],[],false,["if","body-class","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/preferences/ai",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"nGxb2VX3",block:'[[[41,[30,0,["showAutoImageCaptionSetting"]],[[[1,"  "],[10,"label"],[14,0,"control-label"],[12],[1,[28,[35,1],["discourse_ai.title"],null]],[13],[1,"\\n\\n  "],[10,0],[14,0,"control-group ai-setting"],[12],[1,"\\n    "],[8,[39,2],[[24,"data-setting-name","auto-image-caption"],[24,0,"pref-auto-image-caption"]],[["@labelKey","@checked"],["discourse_ai.ai_helper.image_caption.automatic_caption_setting",[30,0,["model","user_option","auto_image_caption"]]]],null],[1,"\\n  "],[13],[1,"\\n\\n  "],[8,[39,3],null,[["@id","@model","@action","@saved"],["user_ai_preference_save",[30,0,["model"]],[30,0,["save"]],[30,0,["saved"]]]],null],[1,"\\n"]],[]],null]],[],false,["if","i18n","preference-checkbox","save-controls"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/preferences/ai.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/initializers/admin-plugin-configuration-nav",["exports","discourse/lib/admin-plugin-config-nav","discourse/lib/plugin-api"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-plugin-configuration-nav",initialize(e){const i=e.lookup("service:current-user")
i&&i.admin&&(0,s.withPluginApi)("1.1.0",(e=>{e.addAdminPluginConfigurationNav("discourse-ai",t.PLUGIN_NAV_MODE_TOP,[{label:"discourse_ai.llms.short_title",route:"adminPlugins.show.discourse-ai-llms"},{label:"discourse_ai.ai_persona.short_title",route:"adminPlugins.show.discourse-ai-personas"},{label:"discourse_ai.tools.short_title",route:"adminPlugins.show.discourse-ai-tools"},{label:"discourse_ai.usage.short_title",route:"adminPlugins.show.discourse-ai-usage"}])}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-artifacts",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-artifact","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
function a(e){e.decorateCookedElement(((e,t)=>{t.renderGlimmer&&[...e.querySelectorAll("div.ai-artifact")].forEach((e=>{const a=e.getAttribute("data-ai-artifact-id"),r=e.getAttribute("data-ai-artifact-version")
t.renderGlimmer(e,(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"pqt7PatD",block:'[[[1,"\\n            "],[8,[32,0],null,[["@artifactId","@artifactVersion"],[[32,1],[32,2]]],null],[1,"\\n          "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-artifacts.js",scope:()=>[s.default,a,r],isStrictMode:!0}),(0,n.default)(void 0,void 0)))}))}),{id:"ai-artifact",onlyStream:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-artifact",initialize(){(0,t.withPluginApi)("0.8.7",a)}}})),define("discourse/plugins/discourse-ai/initializers/ai-bot-replies",["exports","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse-common/lib/deprecated","discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,c,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let d=[],p=!1
function m(e){return e&&d.includes(e.id)}function g(e){e.headerIcons.add("ai",o.default)}function h(e){(function(e){const t=e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e
m(s.user)&&t.add("ai-cancel-gpt",n.default,{before:i,after:["ai-share","ai-debug"]})})),s=t&&"discourse.post-menu-widget-overrides";(0,i.withSilencedDeprecations)(s,(()=>function(e){e.addPostMenuButton("cancel-gpt",(e=>{if(m(e.user))return{icon:"pause",action:"cancelStreaming",title:"discourse_ai.ai_bot.cancel_streaming",className:"btn btn-default cancel-streaming",position:"first"}})),e.attachWidgetAction("post","cancelStreaming",(function(){n.default.cancelStreaming(this.model)}))}(e)))})(e),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,c.streamPostText)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(m).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-2)},unsubscribe:function(){this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}function _(e){let t=null
e.decorateWidget("poster-name:after",(s=>{if(m(s.attrs.user))return t=t||e.container.lookup("controller:topic"),s.widget.attach("persona-flair",{topicController:t})})),(0,s.registerWidgetShim)("persona-flair","span.persona-flair",(0,u.createTemplateFactory)({id:"9jYzNJdM",block:'[[[1,[30,1,["topicController","model","ai_persona_name"]]]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-bot-replies.js",isStrictMode:!1}))}function f(e){const t=e.getCurrentUser()
if(!t||!t.ai_enabled_chat_bots||!p)return
const s=e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e
"private_message"===s.topic?.archetype&&t.add("ai-debug",a.default,{before:i,after:"ai-share"})}))&&"discourse.post-menu-widget-overrides";(0,i.withSilencedDeprecations)(s,(()=>function(e){const t=e.getCurrentUser()
let s=async function(t){let{post:s}=t
const i=e.container.lookup("service:modal")
a.default.debugAiResponse(s,i)}
e.addPostMenuButton("debugAi",(e=>{if("private_message"===e.topic?.archetype&&(0,l.isPostFromAiBot)(e,t))return{action:s,icon:"info",className:"post-action-menu__debug-ai",title:"discourse_ai.ai_bot.debug_ai",position:"first"}}))}(e)))}function b(e){const t=e.getCurrentUser()
if(!t||!t.ai_enabled_chat_bots)return
const s=e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e
"private_message"===s.topic?.archetype&&t.add("ai-share",r.default,{before:i})}))&&"discourse.post-menu-widget-overrides";(0,i.withSilencedDeprecations)(s,(()=>function(e){const t=e.getCurrentUser()
let s=async function(t){let{post:s,showFeedback:i}=t
const o=e.container.lookup("service:modal")
r.default.shareAiResponse(s,o,i)}
e.addPostMenuButton("share",(e=>{if("private_message"===e.topic?.archetype&&(0,l.isPostFromAiBot)(e,t))return{action:s,icon:"far-copy",className:"post-action-menu__share-ai",title:"discourse_ai.ai_bot.share",position:"first"}}))}(e)))}e.default={name:"discourse-ai-bot-replies",initialize(e){const s=e.lookup("service:current-user")
s?.ai_enabled_chat_bots&&(d=s.ai_enabled_chat_bots.map((e=>e.id)),p=s.can_debug_ai_bot_conversations,(0,t.withPluginApi)("1.6.0",g),(0,t.withPluginApi)("1.34.0",h),(0,t.withPluginApi)("1.6.0",_),(0,t.withPluginApi)("1.34.0",(e=>f(e))),(0,t.withPluginApi)("1.34.0",(e=>b(e))),(0,t.withPluginApi)("1.22.0",(e=>function(e){const t=e.container.lookup("service:modal"),s=e.container.lookup("service:current-user")
e.registerTopicFooterButton({id:"share-ai-conversation",icon:"share-alt",label:"discourse_ai.ai_bot.share_ai_conversation.name",title:"discourse_ai.ai_bot.share_ai_conversation.title",action(){(0,l.showShareConversationModal)(t,this.topic.id)},classNames:["share-ai-conversation-button"],dependentKeys:["topic.ai_persona_name"],displayed(){return s?.can_share_ai_bot_conversations&&this.topic.ai_persona_name}})}(e))))}}})),define("discourse/plugins/discourse-ai/initializers/ai-chat-summarization",["exports","discourse/lib/api","discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.34.0",(e=>{const t=e.container.lookup("service:site-settings"),i=e.getCurrentUser(),o=e.container.lookup("service:chat"),n=e.container.lookup("service:modal"),a=i&&i.can_summarize
t.chat_enabled&&o?.userCanChat&&a&&e.registerChatComposerButton({translatedLabel:"discourse_ai.summarization.chat.title",id:"channel-summary",icon:"discourse-sparkles",position:"dropdown",action:()=>{n.show(s.default,{model:{channelId:o.activeChannel?.id}})}})}))})),define("discourse/plugins/discourse-ai/initializers/ai-helper",["exports","discourse/lib/plugin-api","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-helper",initialize(){(0,t.withPluginApi)("1.1.0",(e=>{(function(e){e.onToolbarCreate((t=>{const a=e.getCurrentUser(),r=e.container.lookup("service:modal"),l=e=>{const t=e.getText(),s=e.selected.value
return s&&s.length>0?s:t&&t.length>0?t:void 0}
t.addButton({id:"ai-helper-trigger",group:"extras",icon:"discourse-sparkles",title:"discourse_ai.ai_helper.context_menu.trigger",preventFocus:!0,shortcut:"ALT+P",shortcutAction:t=>{if(0===t.getText().length)return e.container.lookup("service:toasts").error({class:"ai-proofread-error-toast",duration:3e3,data:{message:(0,s.default)("discourse_ai.ai_helper.no_content_error")}})
const i=a?.ai_helper_prompts.find((e=>"proofread"===e.name)).id
r.show(o.default,{model:{mode:i,selectedText:l(t),toolbarEvent:t}})},condition:()=>(0,n.showComposerAiHelper)(e.container.lookup("service:composer").model,e.container.lookup("service:site-settings"),a,"context_menu"),sendAction:t=>{e.container.lookup("service:menu").show(document.querySelector(".ai-helper-trigger"),{identifier:"ai-composer-helper-menu",component:i.default,modalForMobile:!0,interactive:!0,data:{toolbarEvent:t,selectedText:l(t)}})}})}))})(e)}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse/lib/uploads","discourse-i18n"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,i.apiInitializer)("1.25.0",(e=>{const i={label:n.default.t("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},a=e.container.lookup("service:site-settings"),r=e.getCurrentUser()
if(!a.ai_helper_enabled_features.includes("image_caption")||!r?.can_use_assistant)return
function l(e){return e.length<20||1===e.split(" ").length}async function c(e,i){try{return(await(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:e,image_url_type:i}})).caption}catch(o){d.error({class:"ai-image-caption-error-toast",duration:3e3,data:{message:(0,s.extractError)(o)}})}}e.addSaveableUserOptionField("auto_image_caption"),e.addComposerImageWrapperButton(i.label,i.class,i.icon,(i=>{const o=e.container.lookup("service:imageCaptionPopup")
if(o.popupTrigger=i.target,o.popupTrigger.classList.contains("generate-caption")){const n=i.target.closest(".button-wrapper"),a=parseInt(n.getAttribute("data-image-index"),10),r=i.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
o.toggleLoadingState(!0)
const l=e.container.lookup("service:site")
l.mobileView||(o.showPopup=!o.showPopup),o._request=(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:r,image_url_type:"long_url"}}),o._request.then((e=>{let{caption:t}=e
o.imageSrc=r,o.imageIndex=a,o.newCaption=t,l.mobileView&&o.updateCaption()})).catch(s.popupAjaxError).finally((()=>{o.toggleLoadingState(!1)}))}}))
const u=a?.ai_auto_image_caption_allowed_groups.split("|").map((e=>parseInt(e,10)))
if(!r.groups.map((e=>e.id)).some((e=>u.includes(e))))return
const d=e.container.lookup("service:toasts")
e.addComposerUploadMarkdownResolver((async e=>{if(!r.get("user_option.auto_image_caption")||!(0,o.isImage)(e.url)||!l(e.original_filename)||(t=e.width,s=e.height,t*s/1e6<=.1))return(0,o.getUploadMarkdown)(e)
var t,s
const i=await c(e.url,"long_url")
return i?`![${i}|${e.thumbnail_width}x${e.thumbnail_height}](${e.short_url})`:(0,o.getUploadMarkdown)(e)})),e.composerBeforeSave((()=>new Promise(((t,s)=>{const i=e.container.lookup("service:dialog"),a=e.container.lookup("service:composer"),u="discourse_ai.ai_helper.image_caption.automatic_caption_dialog",d=r.get("user_option.auto_image_caption"),p=a.model.reply.match(o.IMAGE_MARKDOWN_REGEX)
p?.length>0||t()
const m=p.filter((e=>l(e.substring(e.indexOf("[")+1,e.indexOf("]")).split("|")[0]))),g=m?.length>0,h=e.container.lookup("service:key-value-store"),_=e.container.lookup("service:imageCaptionPopup"),f="ai-auto-caption-seen",b=h.getItem(f)
if(d||!g||b)return t()
h.setItem(f,!0),i.confirm({message:n.default.t(`${u}.prompt`),confirmButtonLabel:`${u}.confirm`,cancelButtonLabel:`${u}.cancel`,class:"ai-image-caption-prompt-dialog",didConfirm:async()=>{try{r.set("user_option.auto_image_caption",!0),await r.save(["auto_image_caption"]),m.forEach((async e=>{const s=function(e){const t=e.match(/\(upload:\/\/([^)]+)\)/)
return t?`upload://${t[1]}`:null}(e)
_.showAutoCaptionLoader=!0
const i=await c(s,"short_url"),o=new RegExp(`(!\\[)[^|]+(\\|[^\\]]+\\]\\(${s}\\))`),n=a.model.reply.replace(o,`$1${i}$2`)
a.model.set("reply",n),_.showAutoCaptionLoader=!1,t()}))}catch(e){s(e)}},didCancel:()=>{t()}})}))))}))})),define("discourse/plugins/discourse-ai/initializers/ai-semantic-search",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAi:ai-result"]})}))})),define("discourse/plugins/discourse-ai/initializers/related-topics",["exports","@glimmer/tracking","discourse/components/basic-topic-list","discourse/lib/plugin-api","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"ub/16OCY",block:'[[[1,"\\n  "],[10,0],[14,"role","complementary"],[14,"aria-labelledby","related-topics-title"],[14,1,"related-topics"],[14,0,"more-topics__list"],[12],[1,"\\n    "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n      "],[1,[28,[32,0],["discourse-sparkles"],null]],[1,[28,[32,1],["discourse_ai.related_topics.title"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"topics"],[12],[1,"\\n      "],[8,[32,2],null,[["@topics"],[[30,1,["relatedTopics"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@topic"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/related-topics.js",scope:()=>[o.default,n.default,s.default],isStrictMode:!0}),(0,l.default)(void 0,"related-topics:RelatedTopics"))
e.default={name:"discourse-ai-related-topics",initialize(e){const s=e.lookup("service:site-settings")
s.ai_embeddings_enabled&&s.ai_embeddings_semantic_related_topics_enabled&&(0,i.withPluginApi)("1.37.2",(e=>{e.registerMoreTopicsTab({id:"related-topics",name:(0,n.default)("discourse_ai.related_topics.pill"),icon:"discourse-sparkles",component:c,condition:e=>{let{topic:t}=e
return t.relatedTopics?.length}}),e.modifyClass("model:topic",(e=>class extends e{static#e=(()=>dt7948.g(this.prototype,"related_topics",[t.tracked]))()
#ss=(()=>{dt7948.i(this,"related_topics")})()
relatedTopicsCache=[]
get relatedTopics(){return this.related_topics&&(this.relatedTopicsCache=this.related_topics),this.relatedTopicsCache?.map((e=>this.store.createRecord("topic",e)))}static#i=(()=>dt7948.n(this.prototype,"relatedTopics",[t.cached]))()})),e.modifyClass("model:post-stream",(e=>class extends e{_setSuggestedTopics(e){super._setSuggestedTopics(...arguments),this.topic.related_topics=e.related_topics}}))}))}}})),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]"]),e.allowList(["div[class=ai-artifact]","div[data-ai-artifact-id]","div[data-ai-artifact-version]"])}}))

//# sourceMappingURL=discourse-ai-92d7557f1e6f2210b28ca4e40540fbaa52fb5f8fa1916539c905ad5c38738240.map
//!

;
